<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Boom & Doom</title>
    
    <meta name="description" content="Boom & Doom: Rust Raid & Crafting Calculator.">
    <meta property="og:title" content="Boom & Doom">
    <meta property="og:description" content="Spoƒç√≠tej si raid. Napl√°nuj zk√°zu.">
    <meta property="og:type" content="website">

    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#8a1c1c">
    <link rel="icon" type="image/png" href="img/icon-192.png">
    <link rel="apple-touch-icon" href="img/icon-192.png">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/lipis/flag-icons@6.11.0/css/flag-icons.min.css"/>
    
    <style>
        :root {
            --bg-color: #121212;
            --panel-color: #1e1e1e;
            --accent-color: #d32f2f;
            --btn-color: #c62828;
            --btn-hover: #e53935;
            --btn-reset: #424242;
            --text-color: #e0e0e0;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            justify-content: center;
            padding: 20px;
            margin: 0;
            min-height: 100vh;
        }
        .container {
            background-color: var(--panel-color);
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 25px rgba(0,0,0,0.8);
            max-width: 600px;
            width: 100%;
            display: flex;
            flex-direction: column;
            border-top: 4px solid var(--accent-color);
            position: relative;
        }
        
        /* HEADER LAYOUT */
        .header-top {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 25px;
            gap: 15px;
        }
        
        .title-wrapper {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .app-logo {
            width: 45px;
            height: 45px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(211, 47, 47, 0.3);
        }

        h1 { 
            color: var(--accent-color); 
            margin: 0; 
            font-size: 1.8rem; 
            text-transform: uppercase; 
            letter-spacing: 2px; 
            font-weight: 800; 
            text-shadow: 0 0 15px rgba(211, 47, 47, 0.4);
            white-space: nowrap; 
        }

        .lang-buttons {
            display: flex;
            gap: 8px;
        }

        /* --- DESKTOP √öPRAVA (Flags Higher, Title Lower) --- */
        @media (min-width: 700px) {
            .header-top {
                display: grid;
                /* 1fr (levo) | auto (st≈ôed) | 1fr (pravo) */
                grid-template-columns: 1fr auto 1fr;
                align-items: start; /* Zarovnat v≈°e nahoru, ne na st≈ôed */
                margin-bottom: 10px; /* Men≈°√≠ spodn√≠ odsazen√≠, proto≈æe nadpis je posunut√Ω */
            }

            .title-wrapper {
                grid-column: 2; 
                margin-top: 15px; /* ODSTRƒå√çME NADPIS DOL≈Æ */
            }

            .lang-buttons {
                grid-column: 3; 
                justify-self: end; 
                margin-top: -15px; /* VYT√ÅHNEME VLAJEƒåKY NAHORU (do paddingu kontejneru) */
            }
        }

        .flag-btn {
            background: #141414;
            border: 2px solid #444;
            border-radius: 50%;
            cursor: pointer;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: 0.2s;
            overflow: hidden;
            padding: 0;
            filter: grayscale(100%);
        }
        .flag-btn span { font-size: 24px; line-height: 1em; }
        .flag-btn:hover, .flag-btn.active {
            filter: grayscale(0%);
            border-color: var(--accent-color);
            transform: scale(1.1);
        }
        
        /* TABS */
        .tabs {
            display: flex;
            margin-bottom: 20px;
            background: #000;
            border-radius: 6px;
            padding: 5px;
        }
        .tab-btn {
            flex: 1;
            padding: 12px;
            background: transparent;
            border: none;
            color: #666;
            font-weight: bold;
            text-transform: uppercase;
            cursor: pointer;
            border-radius: 4px;
            transition: 0.2s;
        }
        .tab-btn.active {
            background: var(--accent-color);
            color: white;
            box-shadow: 0 0 10px rgba(211, 47, 47, 0.4);
        }
        
        /* Views */
        .view-section { display: none; animation: fadeIn 0.3s ease-in-out; }
        .view-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* Form Elements */
        label { display: block; margin-bottom: 8px; font-weight: bold; margin-top: 15px; font-size: 0.9em; color: #aaa;}
        input, select {
            width: 100%;
            padding: 12px;
            background-color: #0a0a0a;
            border: 1px solid #333;
            color: white;
            border-radius: 4px;
            font-size: 16px;
            box-sizing: border-box;
        }
        
        /* Buttons Group */
        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 25px;
        }

        button.calc-btn {
            flex: 2;
            padding: 15px;
            background-color: var(--btn-color);
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 18px;
            cursor: pointer;
            font-weight: bold;
            text-transform: uppercase;
            transition: 0.2s;
            box-shadow: 0 4px 0 #8c1b1b;
        }
        button.calc-btn:hover { background-color: var(--btn-hover); transform: translateY(1px); box-shadow: 0 3px 0 #8c1b1b; }
        button.calc-btn:active { transform: translateY(4px); box-shadow: none; }

        button.reset-btn {
            flex: 1;
            padding: 15px;
            background-color: var(--btn-reset);
            color: #aaa;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            font-weight: bold;
            text-transform: uppercase;
            transition: 0.2s;
        }
        button.reset-btn:hover { background-color: #555; color: white; }
        
        /* Results */
        .result-box {
            margin-top: 25px;
            padding: 20px;
            background-color: #0a0a0a;
            border-left: 5px solid var(--accent-color);
            display: none;
            border-radius: 4px;
        }
        
        /* Raid Table */
        .raid-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        .raid-table th { text-align: left; color: #888; font-size: 0.8em; padding-bottom: 10px; border-bottom: 1px solid #333; }
        .raid-table td { padding: 12px 0; border-bottom: 1px solid #222; vertical-align: middle;}
        
        .raid-method-flex {
            display: flex;
            align-items: center;
        }
        .raid-method-icon { width: 28px; height: 28px; margin-right: 10px; object-fit: contain; }
        
        .sulfur-cost { color: #ffca28; font-weight: bold; font-size: 0.9em; }
        .item-count { font-size: 1.1em; font-weight: bold; color: #fff; }

        .item-image { display: block; margin: 0 auto 15px auto; max-width: 100px; height: auto; }
        .big-number { font-size: 1.5em; color: var(--accent-color); font-weight: bold; text-align: center; }
        .section-title { color: #888; text-transform: uppercase; font-size: 0.85em; margin-top: 20px; margin-bottom: 10px; border-bottom: 1px solid #333; padding-bottom: 5px;}
        
        ul { list-style-type: none; padding: 0; }
        ul li { background: #161616; margin-bottom: 5px; padding: 8px; border-radius: 4px; display: flex; justify-content: space-between; align-items: center;}
        .val { color: #fff; font-weight: bold; }
        
        .instruction {
            background-color: #1a1a1a;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 10px;
            border: 1px solid #333;
            line-height: 1.6;
        }
        .instruction span { color: #ef5350; font-weight: bold; }
        
        /* Install Button - Hidden on Desktop */
        #installBtn {
            display: none; width: 100%; padding: 10px; background-color: #333;
            color: #fff; border: 1px solid #555; border-radius: 4px; margin-bottom: 20px;
            cursor: pointer; text-align: center; font-size: 14px;
        }
        
        /* Hide Install button strictly on screens wider than 768px (Tablets/PC) */
        @media (min-width: 768px) {
            #installBtn { display: none !important; }
        }
    </style>
</head>
<body>

<div class="container">
    <button id="installBtn">üì≤ Install App</button>

    <div class="header-top">
        <div class="title-wrapper">
            <img src="img/icon-192.png" alt="Logo" class="app-logo">
            <h1>Boom & Doom</h1>
        </div>
        <div class="lang-buttons">
            <button class="flag-btn active" onclick="setLang('en')" id="btn-en"><span class="fi fi-us"></span></button>
            <button class="flag-btn" onclick="setLang('cs')" id="btn-cs"><span class="fi fi-cz"></span></button>
            <button class="flag-btn" onclick="setLang('ru')" id="btn-ru"><span class="fi fi-ru"></span></button>
            <button class="flag-btn" onclick="setLang('zh')" id="btn-zh"><span class="fi fi-cn"></span></button>
        </div>
    </div>

    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('craft')" id="t_tabCraft">Crafting</button>
        <button class="tab-btn" onclick="switchTab('raid')" id="t_tabRaid">Raid Calc</button>
    </div>

    <div id="view-craft" class="view-section active">
        <label for="itemType" id="t_selectItem">Select Item</label>
        <select id="itemType">
            </select>

        <label for="sulfur" id="t_enterSulfur">Sulfur Amount</label>
        <input type="number" id="sulfur" placeholder="50000">

        <div class="btn-group">
            <button onclick="calculateCraft()" id="t_calculateBtn" class="calc-btn">Calculate</button>
            <button onclick="resetCraft()" id="t_resetBtn" class="reset-btn">Reset</button>
        </div>

        <div id="craftResult" class="result-box">
            <img id="resultImage" src="" alt="Item" class="item-image">
            <div style="text-align: center; margin-bottom: 20px;">
                <div id="t_youCanCraft">You can craft:</div>
                <div id="finalCount" class="big-number">0</div>
                <div id="itemNameDisplay" style="color:#aaa;"></div>
            </div>
            <div class="section-title" id="t_sulfurManagement">1. Sulfur Management</div>
            <div class="instruction">
                <span id="t_step1">Take</span> <span id="sulfurToGP">0</span> <span id="t_sulfurRaw">Sulfur</span>.<br>
                <span id="t_step2">Craft it into</span> <span id="gpCount">0</span> <span id="t_gp">Gunpowder</span>.
            </div>
            <div class="instruction" id="expInstructionBox">
                <span id="t_step3">Keep</span> <span id="sulfurToKeep">0</span> <span id="t_sulfurRaw2">Sulfur</span> <span id="t_inInventory">raw in inventory</span>.<br>
                <span id="t_step4">Use it to craft</span> <span id="expCount">0</span> <span id="expLabel">Explosives</span>.
            </div>
            <div class="section-title" id="t_otherMaterials">2. Other Materials Needed</div>
            <ul id="materialsList"></ul>
        </div>
    </div>

    <div id="view-raid" class="view-section">
        <label id="t_selectTarget">Select Target</label>
        <select id="targetType" onchange="calculateRaid()">
            </select>

        <label id="t_targetCountLabel">Number of Targets (e.g. 5 walls)</label>
        <input type="number" id="targetCount" value="1" min="1" oninput="calculateRaid()">

        <div id="raidResult" class="result-box" style="display:block;">
            <div class="section-title" id="t_raidOptions">Recommended Methods</div>
            <table class="raid-table">
                <thead>
                    <tr>
                        <th id="t_method">Method</th>
                        <th id="t_quantity">Amount</th>
                        <th id="t_cost">Total Sulfur</th>
                    </tr>
                </thead>
                <tbody id="raidTableBody">
                    </tbody>
            </table>
            <div style="text-align:center; margin-top:15px; font-size:0.8em; color:#666;">
                * Costs include crafting explosives & GP.
            </div>
        </div>
    </div>

</div>

<script>
    // --- TRANSLATIONS ---
    const translations = {
        en: {
            tabCraft: "Crafting",
            tabRaid: "Raid / Doom",
            selectItem: "What to craft?",
            enterSulfur: "Total Sulfur Amount",
            calculateBtn: "Calculate",
            resetBtn: "Reset",
            youCanCraft: "You can craft:",
            sulfurManagement: "1. Sulfur Management",
            otherMaterials: "2. Other Materials Needed",
            step1: "Take",
            step2: "Cook into",
            step3: "Keep",
            step4: "Use for",
            sulfurRaw: "Sulfur",
            gp: "Gunpowder",
            explosives: "Explosives",
            inInventory: "raw",
            leftover: "Leftover",
            useForAmmo: "Directly for Ammo",
            selectTarget: "Select Target to Destroy",
            targetCountLabel: "Number of Targets",
            raidOptions: "Destruction Methods (Cheapest first)",
            method: "Weapon",
            quantity: "Amount",
            cost: "Total Sulfur",
            items: {
                rocket: "Rocket", c4: "C4", hv: "HV Rocket", incen: "Incendiary Rocket",
                exp556: "Explosive Ammo", satchel: "Satchel Charge", beancan: "Beancan Grenade",
                charcoal: "Charcoal", frags: "Fragments", fuel: "LGF", pipe: "Pipe", tech: "Tech Trash", cloth: "Cloth"
            },
            targets: {
                woodWall: "Wood Wall / Door",
                stoneWall: "Stone Wall / Foundation",
                metalWall: "Sheet Metal Wall",
                armoredWall: "Armored Wall",
                sheetDoor: "Sheet Metal Door",
                garageDoor: "Garage Door",
                armoredDoor: "Armored Door",
                highWood: "High External Wood",
                highStone: "High External Stone"
            }
        },
        cs: {
            tabCraft: "V√Ωroba (Crafting)",
            tabRaid: "Raid (Doom)",
            selectItem: "Co chce≈° vyr√°bƒõt?",
            enterSulfur: "Mno≈æstv√≠ sulfuru",
            calculateBtn: "Spoƒç√≠tat",
            resetBtn: "Reset",
            youCanCraft: "M≈Ø≈æe≈° vyrobit:",
            sulfurManagement: "1. Mana≈æment Sulfuru",
            otherMaterials: "2. Dal≈°√≠ suroviny",
            step1: "Vezmi",
            step2: "Udƒõlej z nƒõj",
            step3: "Nech si",
            step4: "Pou≈æij na",
            sulfurRaw: "Sulfuru",
            gp: "Gunpowder",
            explosives: "Explosives",
            inInventory: "v invent√°≈ôi",
            leftover: "Zbytek",
            useForAmmo: "P≈ô√≠mo do n√°boj≈Ø",
            selectTarget: "Co chce≈° zniƒçit?",
            targetCountLabel: "Poƒçet c√≠l≈Ø (nap≈ô. 10 zd√≠)",
            raidOptions: "Mo≈ænosti niƒçen√≠ (Od nejlevnƒõj≈°√≠ho)",
            method: "Zbra≈à",
            quantity: "Poƒçet",
            cost: "Cena Sulfuru",
            items: {
                rocket: "Raketa", c4: "C4", hv: "HV Raketa", incen: "Z√°paln√° Raketa",
                exp556: "Explozivn√≠ 5.56", satchel: "Satchel Charge", beancan: "Beancan",
                charcoal: "Uhl√≠", frags: "Fragmenty", fuel: "Palivo", pipe: "Trubka", tech: "Tech Trash", cloth: "L√°tka"
            },
            targets: {
                woodWall: "D≈ôevƒõn√° stƒõna / Dve≈ôe",
                stoneWall: "Kamenn√° stƒõna / Z√°klady",
                metalWall: "Plechov√° stƒõna (Sheet)",
                armoredWall: "Panc√©≈ôov√° stƒõna (HQM)",
                sheetDoor: "Plechov√© dve≈ôe (Sheet)",
                garageDoor: "Gar√°≈æov√° vrata (Garage)",
                armoredDoor: "Panc√©≈ôov√© dve≈ôe (Armored)",
                highWood: "Vysok√° d≈ôevƒõn√° zeƒè",
                highStone: "Vysok√° kamenn√° zeƒè"
            }
        },
        ru: {
            tabCraft: "–ö—Ä–∞—Ñ—Ç",
            tabRaid: "–†–µ–π–¥ (Doom)",
            selectItem: "–ß—Ç–æ –∫—Ä–∞—Ñ—Ç–∏–º?",
            enterSulfur: "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –°–µ—Ä—ã",
            calculateBtn: "–†–∞—Å—Å—á–∏—Ç–∞—Ç—å",
            resetBtn: "–°–±—Ä–æ—Å",
            youCanCraft: "–ú–æ–∂–Ω–æ —Å–∫—Ä–∞—Ñ—Ç–∏—Ç—å:",
            sulfurManagement: "1. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–æ–π",
            otherMaterials: "2. –¢—Ä–µ–±—É–µ–º—ã–µ —Ä–µ—Å—É—Ä—Å—ã",
            step1: "–í–æ–∑—å–º–∏",
            step2: "–°–∫—Ä–∞—Ñ—Ç–∏",
            step3: "–û—Å—Ç–∞–≤—å",
            step4: "–ò—Å–ø–æ–ª—å–∑—É–π –¥–ª—è",
            sulfurRaw: "–°–µ—Ä—ã",
            gp: "–ü–æ—Ä–æ—Ö–∞",
            explosives: "–í–∑—Ä—ã–≤—á–∞—Ç–∫–∏",
            inInventory: "–≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ",
            leftover: "–û—Å—Ç–∞—Ç–æ–∫",
            useForAmmo: "–ü—Ä—è–º–æ –≤ –ø–∞—Ç—Ä–æ–Ω—ã",
            selectTarget: "–ß—Ç–æ –ª–æ–º–∞–µ–º?",
            targetCountLabel: "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ü–µ–ª–µ–π",
            raidOptions: "–ú–µ—Ç–æ–¥—ã —Ä–µ–π–¥–∞ (–î–µ—à–µ–≤—ã–µ —Å–≤–µ—Ä—Ö—É)",
            method: "–û—Ä—É–∂–∏–µ",
            quantity: "–ö–æ–ª-–≤–æ",
            cost: "–°–µ—Ä–∞",
            items: {
                rocket: "–†–∞–∫–µ—Ç–∞", c4: "C4", hv: "HV –†–∞–∫–µ—Ç–∞", incen: "–ó–∞–∂–∏–≥. —Ä–∞–∫–µ—Ç–∞",
                exp556: "–†–∞–∑—Ä—ã–≤–Ω—ã–µ", satchel: "–°–∞—á–µ–ª—å", beancan: "–ë–∏–Ω–∫–∞–Ω",
                charcoal: "–£–≥–æ–ª—å", frags: "–§—Ä–∞–≥–º–µ–Ω—Ç—ã", fuel: "–¢–æ–ø–ª–µ–≤–æ", pipe: "–¢—Ä—É–±–∞", tech: "–ú–∏–∫—Ä–æ—Å—Ö–µ–º—ã", cloth: "–¢–∫–∞–Ω—å"
            },
            targets: {
                woodWall: "–î–µ—Ä–µ–≤—è–Ω–Ω–∞—è —Å—Ç–µ–Ω–∞",
                stoneWall: "–ö–∞–º–µ–Ω–Ω–∞—è —Å—Ç–µ–Ω–∞",
                metalWall: "–ú–µ—Ç–∞–ª–ª–∏—á–µ—Å–∫–∞—è —Å—Ç–µ–Ω–∞",
                armoredWall: "–ú–í–ö —Å—Ç–µ–Ω–∞",
                sheetDoor: "–ú–µ—Ç–∞–ª–ª–∏—á–µ—Å–∫–∞—è –¥–≤–µ—Ä—å",
                garageDoor: "–ì–∞—Ä–∞–∂–Ω–∞—è –¥–≤–µ—Ä—å",
                armoredDoor: "–ú–í–ö –¥–≤–µ—Ä—å",
                highWood: "–í—ã—Å–æ–∫–∞—è –¥–µ—Ä–µ–≤—è–Ω–Ω–∞—è",
                highStone: "–í—ã—Å–æ–∫–∞—è –∫–∞–º–µ–Ω–Ω–∞—è"
            }
        },
        zh: {
            tabCraft: "Âà∂‰Ωú",
            tabRaid: "ÊãÜÂÆ∂ (Doom)",
            selectItem: "‰Ω†ÊÉ≥Âà∂ÈÄ†‰ªÄ‰πàÔºü",
            enterSulfur: "Á°´Á£∫ÊÄªÈáè",
            calculateBtn: "ËÆ°ÁÆó",
            resetBtn: "ÈáçÁΩÆ",
            youCanCraft: "‰Ω†ÂèØ‰ª•Âà∂ÈÄ†Ôºö",
            sulfurManagement: "1. Á°´Á£∫ÂàÜÈÖç",
            otherMaterials: "2. ÂÖ∂‰ªñÊâÄÈúÄÊùêÊñô",
            step1: "ÂèñÂá∫",
            step2: "Âà∂‰ΩúÊàê",
            step3: "‰øùÁïô",
            step4: "Áî®‰∫éÂà∂‰Ωú",
            sulfurRaw: "Á°´Á£∫",
            gp: "ÁÅ´ËçØ",
            explosives: "ÁÇ∏ËçØ",
            inInventory: "Âú®ËÉåÂåÖ‰∏≠",
            leftover: "Ââ©‰Ωô",
            useForAmmo: "Áõ¥Êé•Áî®‰∫éÂºπËçØ",
            selectTarget: "ÁõÆÊ†áÂª∫Á≠ë",
            targetCountLabel: "ÁõÆÊ†áÊï∞Èáè",
            raidOptions: "ÊãÜÈô§ÊñπÊ≥ï (ÊúÄ‰æøÂÆú‰ºòÂÖà)",
            method: "Ê≠¶Âô®",
            quantity: "Êï∞Èáè",
            cost: "Á°´Á£∫ÊàêÊú¨",
            items: {
                rocket: "ÁÅ´ÁÆ≠", c4: "C4", hv: "È´òÈÄüÁÅ´ÁÆ≠", incen: "ÁáÉÁÉßÁÅ´ÁÆ≠",
                exp556: "ÁàÜÁÇ∏ÂºπËçØ", satchel: "ÁÇ∏ËçØÂåÖ (Satchel)", beancan: "Ë±ÜÁΩêÈõ∑",
                charcoal: "Êú®ÁÇ≠", frags: "ÈáëÂ±ûÁ¢éÁâá", fuel: "‰ΩéÁ∫ßÁáÉÊñô", pipe: "ÈáëÂ±ûÁÆ°", tech: "ÁßëÊäÄÈõ∂‰ª∂", cloth: "Â∏É"
            },
            targets: {
                woodWall: "Êú®Â¢ô / Èó®",
                stoneWall: "Áü≥Â¢ô / Âú∞Âü∫",
                metalWall: "ÈìÅÂ¢ô (Sheet)",
                armoredWall: "ÂêàÈáëÂ¢ô (HQM)",
                sheetDoor: "ÈìÅÈó®",
                garageDoor: "Âç∑Â∏òÈó® (Garage)",
                armoredDoor: "ÂêàÈáëÈó®",
                highWood: "È´òÂ§ñÊú®Â¢ô",
                highStone: "È´òÂ§ñÁü≥Â¢ô"
            }
        }
    };

    // --- CRAFTING RECIPES ---
    const recipes = {
        rocket: { id: "rocket", sulfurTotal: 1400, gpPerItem: 650, explosivesPerItem: 10, rawSulfurToKeep: 100, imgUrl: "https://rustlabs.com/img/items180/ammo.rocket.basic.png", other: [{id:"charcoal", amount:1950},{id:"frags", amount:100},{id:"fuel", amount:30},{id:"pipe", amount:2}] },
        c4: { id: "c4", sulfurTotal: 2200, gpPerItem: 1000, explosivesPerItem: 20, rawSulfurToKeep: 200, imgUrl: "https://rustlabs.com/img/items180/explosive.timed.png", other: [{id:"charcoal", amount:3000},{id:"frags", amount:200},{id:"fuel", amount:60},{id:"tech", amount:2},{id:"cloth", amount:5}] },
        satchel: { id: "satchel", sulfurTotal: 480, gpPerItem: 240, explosivesPerItem: 0, rawSulfurToKeep: 0, imgUrl: "https://rustlabs.com/img/items180/explosive.satchel.png", other: [{id:"charcoal", amount:720}, {id:"frags", amount:80}, {id:"cloth", amount:10}, {id:"rope", amount:1}] },
        exp556: { id: "exp556", sulfurTotal: 25, gpPerItem: 10, explosivesPerItem: 0, rawSulfurToKeep: 5, imgUrl: "https://rustlabs.com/img/items180/ammo.rifle.explosive.png", other: [] }, 
        hv: { id: "hv", sulfurTotal: 200, gpPerItem: 100, explosivesPerItem: 0, rawSulfurToKeep: 0, imgUrl: "https://rustlabs.com/img/items180/ammo.rocket.hv.png", other: [{id:"charcoal", amount:300},{id:"pipe", amount:1}] },
        incen: { id: "incen", sulfurTotal: 610, gpPerItem: 300, explosivesPerItem: 1, rawSulfurToKeep: 10, imgUrl: "https://rustlabs.com/img/items180/ammo.rocket.fire.png", other: [] },
        beancan: { id: "beancan", sulfurTotal: 120, gpPerItem: 60, explosivesPerItem: 0, rawSulfurToKeep: 0, imgUrl: "https://rustlabs.com/img/items180/grenade.beancan.png", other: [] } // Added beancan for raid display
    };

    // --- RAID DATA ---
    const raidTargets = {
        woodWall: { hp: 250, methods: { rocket: 2, satchel: 3, exp556: 49, c4: 1 } },
        stoneWall: { hp: 500, methods: { rocket: 4, satchel: 10, exp556: 185, c4: 2 } },
        metalWall: { hp: 1000, methods: { rocket: 8, satchel: 23, exp556: 400, c4: 4 } },
        armoredWall: { hp: 2000, methods: { rocket: 15, satchel: 46, exp556: 799, c4: 8 } },
        sheetDoor: { hp: 250, methods: { rocket: 1, satchel: 4, exp556: 63, c4: 1 } },
        garageDoor: { hp: 600, methods: { rocket: 3, satchel: 9, exp556: 150, c4: 2 } },
        armoredDoor: { hp: 1000, methods: { rocket: 5, satchel: 15, exp556: 250, c4: 3 } },
        highWood: { hp: 500, methods: { rocket: 3, satchel: 6, exp556: 98, c4: 2 } },
        highStone: { hp: 500, methods: { rocket: 4, satchel: 10, exp556: 185, c4: 2 } }
    };

    let currentLang = "en";

    function switchTab(tab) {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('t_tab' + (tab.charAt(0).toUpperCase() + tab.slice(1))).classList.add('active');
        document.querySelectorAll('.view-section').forEach(v => v.classList.remove('active'));
        document.getElementById('view-' + tab).classList.add('active');
    }

    function setLang(lang) {
        currentLang = lang;
        document.querySelectorAll('.flag-btn').forEach(btn => btn.classList.remove('active'));
        document.getElementById('btn-' + lang).classList.add('active');
        updateUI();
        calculateCraft();
        calculateRaid();
    }

    function updateUI() {
        const t = translations[currentLang];
        document.getElementById('t_tabCraft').innerText = t.tabCraft;
        document.getElementById('t_tabRaid').innerText = t.tabRaid;
        document.getElementById('t_selectItem').innerText = t.selectItem;
        document.getElementById('t_enterSulfur').innerText = t.enterSulfur;
        document.getElementById('t_calculateBtn').innerText = t.calculateBtn;
        document.getElementById('t_resetBtn').innerText = t.resetBtn;
        document.getElementById('t_youCanCraft').innerText = t.youCanCraft;
        document.getElementById('t_sulfurManagement').innerText = t.sulfurManagement;
        document.getElementById('t_otherMaterials').innerText = t.otherMaterials;
        document.getElementById('t_step1').innerText = t.step1;
        document.getElementById('t_step2').innerText = t.step2;
        document.getElementById('t_step3').innerText = t.step3;
        document.getElementById('t_sulfurRaw').innerText = t.sulfurRaw;
        document.getElementById('t_sulfurRaw2').innerText = t.sulfurRaw;
        document.getElementById('t_gp').innerText = t.gp;
        document.getElementById('t_inInventory').innerText = t.inInventory;
        document.getElementById('t_selectTarget').innerText = t.selectTarget;
        document.getElementById('t_targetCountLabel').innerText = t.targetCountLabel;
        document.getElementById('t_raidOptions').innerText = t.raidOptions;
        document.getElementById('t_method').innerText = t.method;
        document.getElementById('t_quantity').innerText = t.quantity;
        document.getElementById('t_cost').innerText = t.cost;
        populateCraftSelect(t);
        populateRaidSelect(t);
    }

    function populateCraftSelect(t) {
        const select = document.getElementById('itemType');
        const savedVal = select.value;
        select.innerHTML = "";
        for (const [key, value] of Object.entries(recipes)) {
            if(key === 'beancan') continue; // Hide beancan from craft select if desired, or keep it
            const opt = document.createElement('option');
            opt.value = key;
            opt.innerText = t.items[value.id];
            select.appendChild(opt);
        }
        if (savedVal && recipes[savedVal]) select.value = savedVal;
    }

    function populateRaidSelect(t) {
        const select = document.getElementById('targetType');
        const savedVal = select.value;
        select.innerHTML = "";
        for (const [key, value] of Object.entries(raidTargets)) {
            const opt = document.createElement('option');
            opt.value = key;
            opt.innerText = t.targets[key];
            select.appendChild(opt);
        }
        if (savedVal && raidTargets[savedVal]) select.value = savedVal;
    }

    function resetCraft() {
        document.getElementById('sulfur').value = "";
        document.getElementById('craftResult').style.display = 'none';
    }

    function calculateCraft() {
        const sulfurInput = parseInt(document.getElementById('sulfur').value);
        const type = document.getElementById('itemType').value;
        const recipe = recipes[type];
        const t = translations[currentLang];
        if (isNaN(sulfurInput) || sulfurInput <= 0) return;
        const maxItems = Math.floor(sulfurInput / recipe.sulfurTotal);
        if (maxItems === 0) { alert(`Not enough Sulfur!`); return; }
        const totalGP = maxItems * recipe.gpPerItem;
        const sulfurForGP = totalGP * 2;
        const totalExp = maxItems * recipe.explosivesPerItem;
        const sulfurReserved = maxItems * recipe.rawSulfurToKeep;
        document.getElementById('resultImage').src = recipe.imgUrl;
        let countText = maxItems + " x " + t.items[recipe.id];
        if(recipe.id === 'exp556') countText += ` (${maxItems} bullets)`;
        document.getElementById('finalCount').innerText = countText;
        const leftover = sulfurInput - (maxItems * recipe.sulfurTotal);
        document.getElementById('itemNameDisplay').innerText = `(${t.leftover}: ${leftover})`;
        document.getElementById('sulfurToGP').innerText = sulfurForGP.toLocaleString();
        document.getElementById('gpCount').innerText = totalGP.toLocaleString();
        const expBox = document.getElementById('expInstructionBox');
        if (recipe.rawSulfurToKeep > 0) {
            expBox.style.display = 'block';
            document.getElementById('sulfurToKeep').innerText = sulfurReserved.toLocaleString();
            document.getElementById('t_step4').innerText = recipe.explosivesPerItem > 0 ? t.step4 : t.useForAmmo;
            document.getElementById('expCount').innerText = recipe.explosivesPerItem > 0 ? totalExp.toLocaleString() : "";
            document.getElementById('expLabel').innerText = recipe.explosivesPerItem > 0 ? " " + t.explosives : "";
        } else {
            expBox.style.display = 'none';
        }
        const listEl = document.getElementById('materialsList');
        listEl.innerHTML = "";
        recipe.other.forEach(mat => {
            const totalNeeded = mat.amount * maxItems;
            const li = document.createElement('li');
            li.innerHTML = `<span>${t.items[mat.id] || mat.id}</span> <span class="val">${totalNeeded.toLocaleString()}</span>`;
            listEl.appendChild(li);
        });
        document.getElementById('craftResult').style.display = 'block';
    }

    function calculateRaid() {
        const targetKey = document.getElementById('targetType').value;
        const countInput = document.getElementById('targetCount').value;
        const count = Math.max(1, parseInt(countInput) || 1); // Min 1

        const target = raidTargets[targetKey];
        const t = translations[currentLang];
        const tbody = document.getElementById('raidTableBody');
        tbody.innerHTML = "";
        let methods = [];
        for (const [weaponKey, amountPerOne] of Object.entries(target.methods)) {
            const recipe = recipes[weaponKey];
            if (!recipe) continue;
            
            const totalAmount = amountPerOne * count;
            const totalSulfur = totalAmount * recipe.sulfurTotal;
            
            methods.push({ key: weaponKey, name: t.items[weaponKey], amount: totalAmount, cost: totalSulfur, img: recipe.imgUrl });
        }
        methods.sort((a, b) => a.cost - b.cost);
        methods.forEach(m => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>
                    <div class="raid-method-flex">
                        <img src="${m.img}" class="raid-method-icon">
                        <span>${m.name}</span>
                    </div>
                </td>
                <td class="item-count">${m.amount}</td>
                <td class="sulfur-cost">${m.cost.toLocaleString()}</td>
            `;
            tbody.appendChild(tr);
        });
    }

    // PWA Logic
    let deferredPrompt;
    const installBtn = document.getElementById('installBtn');
    window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault(); deferredPrompt = e; installBtn.style.display = 'block';
    });
    installBtn.addEventListener('click', async () => {
        if (deferredPrompt) { deferredPrompt.prompt(); deferredPrompt = null; installBtn.style.display = 'none'; }
    });
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => navigator.serviceWorker.register('./sw.js'));
    }

    // Init
    updateUI();
    calculateRaid();
</script>
</body>
</html>
