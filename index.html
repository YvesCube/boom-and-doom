<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Boom & Doom</title>
    
    <meta name="description" content="Boom & Doom: Rust Raid & Crafting Calculator. Eco Raids, Tech Tree costs.">
    <meta property="og:title" content="Boom & Doom">
    <meta property="og:description" content="SpoÄÃ­tej si raid. NaplÃ¡nuj zkÃ¡zu. Eco raid, Soft side, Vehicles.">
    <meta property="og:type" content="website">

    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#8a1c1c">
    <link rel="icon" type="image/png" href="img/icon-192.png">
    <link rel="apple-touch-icon" href="img/icon-192.png">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/lipis/flag-icons@6.11.0/css/flag-icons.min.css"/>
    
    <style>
        :root {
            --bg-color: #121212;
            --panel-color: #1e1e1e;
            --accent-color: #d32f2f;
            --btn-color: #c62828;
            --btn-hover: #e53935;
            --btn-reset: #424242;
            --text-color: #e0e0e0;
            --eco-color: #4caf50;
            --wb1: #72bb53; 
            --wb2: #5bb0ff; 
            --wb3: #ff5b5b; 
            --scrap: #a8a39d;
        }

        /* --- HIDE SCROLLBAR (BUT KEEP SCROLLING) --- */
        /* For Chrome, Safari, Edge, Opera, Android */
        body::-webkit-scrollbar {
            display: none;
        }
        /* For Firefox, IE, Edge */
        body {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            justify-content: center;
            padding: 20px;
            margin: 0;
            min-height: 100vh;
        }
        .container {
            background-color: var(--panel-color);
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 25px rgba(0,0,0,0.8);
            max-width: 600px;
            width: 100%;
            display: flex;
            flex-direction: column;
            border-top: 4px solid var(--accent-color);
            position: relative;
        }
        
        /* HEADER LAYOUT */
        .header-top { display: flex; flex-direction: column; align-items: center; margin-bottom: 25px; gap: 15px; }
        .title-wrapper { display: flex; align-items: center; justify-content: center; gap: 15px; }
        .app-logo { width: 45px; height: 45px; border-radius: 10px; box-shadow: 0 0 10px rgba(211, 47, 47, 0.3); }
        h1 { color: var(--accent-color); margin: 0; font-size: 1.8rem; text-transform: uppercase; letter-spacing: 2px; font-weight: 800; text-shadow: 0 0 15px rgba(211, 47, 47, 0.4); white-space: nowrap; }
        .lang-buttons { display: flex; gap: 8px; }

        @media (min-width: 700px) {
            .header-top { display: grid; grid-template-columns: 1fr auto 1fr; align-items: start; margin-bottom: 10px; }
            .title-wrapper { grid-column: 2; margin-top: 15px; }
            .lang-buttons { grid-column: 3; justify-self: end; margin-top: -15px; }
        }

        .flag-btn { background: #141414; border: 2px solid #444; border-radius: 50%; cursor: pointer; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; transition: 0.2s; overflow: hidden; padding: 0; filter: grayscale(100%); }
        .flag-btn span { font-size: 24px; line-height: 1em; }
        .flag-btn:hover, .flag-btn.active { filter: grayscale(0%); border-color: var(--accent-color); transform: scale(1.1); }
        
        /* TABS */
        .tabs { display: flex; margin-bottom: 20px; background: #000; border-radius: 6px; padding: 5px; gap: 5px; }
        .tab-btn { flex: 1; padding: 12px 5px; background: transparent; border: none; color: #666; font-weight: bold; text-transform: uppercase; cursor: pointer; border-radius: 4px; transition: 0.2s; font-size: 0.9em; }
        .tab-btn.active { background: var(--accent-color); color: white; box-shadow: 0 0 10px rgba(211, 47, 47, 0.4); }
        .tab-btn#t_tabEco.active { background: var(--eco-color); box-shadow: 0 0 10px rgba(76, 175, 80, 0.4); }
        
        .view-section { display: none; animation: fadeIn 0.3s ease-in-out; }
        .view-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        label { display: block; margin-bottom: 8px; font-weight: bold; margin-top: 15px; font-size: 0.9em; color: #aaa;}
        input, select { width: 100%; padding: 12px; background-color: #0a0a0a; border: 1px solid #333; color: white; border-radius: 4px; font-size: 16px; box-sizing: border-box; }
        
        .btn-group { display: flex; gap: 10px; margin-top: 25px; }
        button.calc-btn { flex: 2; padding: 15px; background-color: var(--btn-color); color: white; border: none; border-radius: 4px; font-size: 18px; cursor: pointer; font-weight: bold; text-transform: uppercase; transition: 0.2s; box-shadow: 0 4px 0 #8c1b1b; }
        button.calc-btn:hover { background-color: var(--btn-hover); transform: translateY(1px); box-shadow: 0 3px 0 #8c1b1b; }
        button.calc-btn:active { transform: translateY(4px); box-shadow: none; }
        button.reset-btn { flex: 1; padding: 15px; background-color: var(--btn-reset); color: #aaa; border: none; border-radius: 4px; font-size: 16px; cursor: pointer; font-weight: bold; text-transform: uppercase; transition: 0.2s; }
        button.reset-btn:hover { background-color: #555; color: white; }
        
        .result-box { margin-top: 25px; padding: 20px; background-color: #0a0a0a; border-left: 5px solid var(--accent-color); display: none; border-radius: 4px; }
        
        .raid-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        .raid-table th { text-align: left; color: #888; font-size: 0.8em; padding-bottom: 10px; border-bottom: 1px solid #333; }
        .raid-table td { padding: 12px 0; border-bottom: 1px solid #222; vertical-align: middle;}
        
        .raid-method-flex { display: flex; align-items: center; }
        .raid-method-icon { width: 28px; height: 28px; margin-right: 10px; object-fit: contain; }
        
        .sulfur-cost { color: #ffca28; font-weight: bold; font-size: 0.9em; }
        .item-count { font-size: 1.1em; font-weight: bold; color: #fff; }
        .resource-cost { color: #aaa; font-size: 0.85em; }
        .resource-highlight { color: #fff; font-weight: bold; }

        .item-image { display: block; margin: 0 auto 15px auto; max-width: 100px; height: auto; }
        .big-number { font-size: 1.5em; color: var(--accent-color); font-weight: bold; text-align: center; }
        .section-title { color: #888; text-transform: uppercase; font-size: 0.85em; margin-top: 20px; margin-bottom: 10px; border-bottom: 1px solid #333; padding-bottom: 5px;}
        
        ul { list-style-type: none; padding: 0; }
        ul li { background: #161616; margin-bottom: 5px; padding: 8px; border-radius: 4px; display: flex; justify-content: space-between; align-items: center;}
        .val { color: #fff; font-weight: bold; }
        
        .instruction { background-color: #1a1a1a; padding: 15px; border-radius: 5px; margin-bottom: 10px; border: 1px solid #333; line-height: 1.6; }
        .instruction span { color: #ef5350; font-weight: bold; }
        
        .tech-info { display: flex; justify-content: center; gap: 10px; margin-bottom: 15px; }
        .badge { padding: 4px 8px; border-radius: 4px; font-size: 0.8em; font-weight: bold; color: #fff; text-shadow: 1px 1px 0 #000; }
        .badge-wb1 { background-color: var(--wb1); }
        .badge-wb2 { background-color: var(--wb2); }
        .badge-wb3 { background-color: var(--wb3); }
        .badge-scrap { background-color: var(--scrap); color: #222; text-shadow: none; }

        /* INSTALL & UPDATE BUTTONS */
        #installBtn { display: none; width: 100%; padding: 10px; background-color: #333; color: #fff; border: 1px solid #555; border-radius: 4px; margin-bottom: 20px; cursor: pointer; text-align: center; font-size: 14px; }
        @media (min-width: 768px) { #installBtn { display: none !important; } }

        /* UPDATE TOAST STYLING */
        .update-toast { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background-color: #222; border: 1px solid var(--accent-color); border-radius: 8px; padding: 15px 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.8); z-index: 1000; display: none; animation: slideUp 0.4s ease-out; width: 90%; max-width: 400px; }
        .update-content { display: flex; align-items: center; justify-content: space-between; gap: 15px; }
        .update-content span { color: #fff; font-weight: bold; font-size: 0.9em; }
        #updateBtn { background-color: var(--accent-color); color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; font-weight: bold; text-transform: uppercase; font-size: 0.8em; white-space: nowrap; }
        #updateBtn:hover { background-color: #ff5252; }
        @keyframes slideUp { from { transform: translate(-50%, 100px); opacity: 0; } to { transform: translate(-50%, 0); opacity: 1; } }

        /* FOOTER */
        .footer { margin-top: 40px; padding-top: 20px; border-top: 1px solid #333; text-align: center; font-size: 0.75em; color: #666; line-height: 1.4; }
        .footer p { margin: 5px 0; }
        .version-tag { color: #444; margin-top: 10px; }
        
        /*Â  MOBILE OPTIMIZATIONÂ  */
        @media (max-width: 600px) {
            body { padding: 10px; }
            .container { padding: 15px; width: 100%; box-sizing: border-box; }
            h1 { font-size: 1.5rem; letter-spacing: 1px; }
            .app-logo { width: 35px; height: 35px; }
            .header-top { margin-bottom: 15px; gap: 10px; }
            .lang-buttons { margin-top: 5px; }
            .flag-btn { width: 28px; height: 28px; }
            .flag-btn span { font-size: 20px; }
            input, select, .btn-group { font-size: 16px; }
            .raid-table th, .raid-table td { padding: 8px 0; font-size: 0.9em; }
        }
    </style>
</head>
<body>

<div class="container">
    <button id="installBtn">ðŸ“² Install App</button>

    <div class="header-top">
        <div class="title-wrapper">
            <img src="img/icon-192.png" alt="Logo" class="app-logo">
            <h1>Boom & Doom</h1>
        </div>
        <div class="lang-buttons">
            <button class="flag-btn active" onclick="setLang('en')" id="btn-en"><span class="fi fi-us"></span></button>
            <button class="flag-btn" onclick="setLang('cs')" id="btn-cs"><span class="fi fi-cz"></span></button>
            <button class="flag-btn" onclick="setLang('ru')" id="btn-ru"><span class="fi fi-ru"></span></button>
            <button class="flag-btn" onclick="setLang('zh')" id="btn-zh"><span class="fi fi-cn"></span></button>
        </div>
    </div>

    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('craft')" id="t_tabCraft">Crafting</button>
        <button class="tab-btn" onclick="switchTab('raid')" id="t_tabRaid">Raid Calc</button>
        <button class="tab-btn" onclick="switchTab('eco')" id="t_tabEco">Eco / Special</button>
    </div>

    <div id="view-craft" class="view-section active">
        <label for="itemType" id="t_selectItem">Select Item</label>
        <select id="itemType" onchange="onCraftItemChange()"></select>
        <label for="sulfur" id="t_enterSulfur">Sulfur Amount</label>
        <input type="number" id="sulfur" placeholder="50000">
        <div class="btn-group">
            <button onclick="calculateCraft()" id="t_calculateBtn" class="calc-btn">Calculate</button>
            <button onclick="resetCraft()" id="t_resetBtn" class="reset-btn">Reset</button>
        </div>
        <div id="craftResult" class="result-box">
            <img id="resultImage" src="" alt="Item" class="item-image">
            <div class="tech-info" id="techInfoDisplay"></div>
            <div style="text-align: center; margin-bottom: 20px;">
                <div id="t_youCanCraft">You can craft:</div>
                <div id="finalCount" class="big-number">0</div>
                <div id="itemNameDisplay" style="color:#aaa;"></div>
            </div>
            <div class="section-title" id="t_sulfurManagement">1. Sulfur Management</div>
            <div class="instruction">
                <span id="t_step1">Take</span> <span id="sulfurToGP">0</span> <span id="t_sulfurRaw">Sulfur</span>.<br>
                <span id="t_step2">Craft it into</span> <span id="gpCount">0</span> <span id="t_gp">Gunpowder</span>.
            </div>
            <div class="instruction" id="expInstructionBox">
                <span id="t_step3">Keep</span> <span id="sulfurToKeep">0</span> <span id="t_sulfurRaw2">Sulfur</span> <span id="t_inInventory">raw in inventory</span>.<br>
                <span id="t_step4">Use it to craft</span> <span id="expCount">0</span> <span id="expLabel">Explosives</span>.
            </div>
            <div class="section-title" id="t_otherMaterials">2. Other Materials Needed</div>
            <ul id="materialsList"></ul>
        </div>
    </div>

    <div id="view-raid" class="view-section">
        <label id="t_selectTarget">Select Target</label>
        <select id="targetType" onchange="calculateRaid()"></select>
        <label id="t_targetCountLabel">Number of Targets</label>
        <input type="number" id="targetCount" value="1" min="1" oninput="calculateRaid()">
        <div id="raidResult" class="result-box" style="display:block;">
            <img id="raidTargetImage" src="" alt="Target" class="item-image" style="display:none;">
            <div class="section-title" id="t_raidOptions">Recommended Methods</div>
            <table class="raid-table">
                <thead><tr><th id="t_method">Method</th><th id="t_quantity">Amount</th><th id="t_cost">Cost</th></tr></thead>
                <tbody id="raidTableBody"></tbody>
            </table>
        </div>
    </div>

    <div id="view-eco" class="view-section">
        <label id="t_selectEcoTarget">Select Special Target</label>
        <select id="ecoTargetType" onchange="calculateEco()"></select>
        <div id="ecoResult" class="result-box" style="display:block; border-color: #4caf50;">
            <img id="ecoTargetImage" src="" alt="Target" class="item-image" style="display:none;">
            <div class="section-title" id="t_ecoOptions">Destruction Methods</div>
            <table class="raid-table">
                <thead><tr><th id="t_ecoMethod">Method</th><th id="t_ecoQuantity">Amount</th><th id="t_ecoCost">Materials Needed</th></tr></thead>
                <tbody id="ecoTableBody"></tbody>
            </table>
        </div>
    </div>

    <div class="footer">
        <p>Boom & Doom is an unofficial tool. Not affiliated with Facepunch Studios.</p>
        <p>Game assets &copy; Facepunch Studios. Data source: RustLabs.</p>
        <p class="version-tag">Version: <span id="appVersionDisplay">...</span></p>
    </div>

    <div id="updateNotification" class="update-toast">
        <div class="update-content">
            <span>New version available!</span>
            <button id="updateBtn">Update Now</button>
        </div>
    </div>

</div>

<script>
    // --- APP VERSION (Change this manually when you update sw.js) ---
    const APP_VERSION = "v2.0.0.3"; 
    document.getElementById('appVersionDisplay').innerText = APP_VERSION;

    // --- TRANSLATIONS ---
    const translations = {
        en: { tabCraft:"Crafting",tabRaid:"Raid",tabEco:"Eco / Special",selectItem:"What to craft?",enterSulfur:"Total Sulfur Amount",calculateBtn:"Calculate",resetBtn:"Reset",youCanCraft:"You can craft:",sulfurManagement:"1. Sulfur Management",otherMaterials:"2. Other Materials Needed",step1:"Take",step2:"Cook into",step3:"Keep",step4:"Use for",sulfurRaw:"Sulfur",gp:"Gunpowder",explosives:"Explosives",inInventory:"raw",leftover:"Leftover",useForAmmo:"Directly for Ammo",selectTarget:"Select Target to Destroy",selectEcoTarget:"Select Special Target",targetCountLabel:"Number of Targets",raidOptions:"Destruction Methods",ecoOptions:"Destruction Methods (Off-Meta)",method:"Weapon",ecoMethod:"Tool / Weapon",quantity:"Amount",ecoQuantity:"Amount",cost:"Total Cost",ecoCost:"Materials",items:{rocket:"Rocket",c4:"C4",hv:"HV Rocket",incen:"Incendiary Rocket",exp556:"Explosive Ammo",satchel:"Satchel Charge",beancan:"Beancan Grenade",molotov:"Molotov",hatchet:"Hatchet",pickaxe:"Pickaxe",spear:"Wooden Spear",sword:"Salvaged Sword",jackhammer:"Jackhammer",fireArrow:"Fire Arrow",charcoal:"Charcoal",frags:"Fragments",fuel:"LGF",pipe:"Pipe",tech:"Tech Trash",cloth:"Cloth",wood:"Wood"},targets:{woodDoor:"Wooden Door",woodDouble:"Wood Double Door",woodWall:"Wood Wall",stoneWall:"Stone Wall / Foundation",metalWall:"Sheet Metal Wall",armoredWall:"Armored Wall",sheetDoor:"Sheet Metal Door",sheetDouble:"Sheet Metal Double Door",garageDoor:"Garage Door",armoredDoor:"Armored Door",armoredDouble:"Armored Double Door",highWood:"High External Wood",highStone:"High External Stone",turret:"Auto Turret",sam:"SAM Site",tc:"Tool Cupboard (TC)",softWood:"Wood Wall (Soft Side)",softStone:"Stone Wall (Soft Side)",mini:"Minicopter",scrappy:"Scrap Heli",camper:"Camper Module"} },
        cs: { tabCraft:"VÃ½roba",tabRaid:"Raid",tabEco:"Eco / Special",selectItem:"Co chceÅ¡ vyrÃ¡bÄ›t?",enterSulfur:"MnoÅ¾stvÃ­ sulfuru",calculateBtn:"SpoÄÃ­tat",resetBtn:"Reset",youCanCraft:"MÅ¯Å¾eÅ¡ vyrobit:",sulfurManagement:"1. ManaÅ¾ment Sulfuru",otherMaterials:"2. DalÅ¡Ã­ suroviny",step1:"Vezmi",step2:"UdÄ›lej z nÄ›j",step3:"Nech si",step4:"PouÅ¾ij na",sulfurRaw:"Sulfuru",gp:"Gunpowder",explosives:"Explosives",inInventory:"v inventÃ¡Å™i",leftover:"Zbytek",useForAmmo:"PÅ™Ã­mo do nÃ¡bojÅ¯",selectTarget:"Co chceÅ¡ zniÄit?",selectEcoTarget:"Co chceÅ¡ zniÄit? (Off-meta)",targetCountLabel:"PoÄet cÃ­lÅ¯",raidOptions:"MoÅ¾nosti niÄenÃ­",ecoOptions:"MoÅ¾nosti niÄenÃ­ (Off-Meta)",method:"ZbraÅˆ",ecoMethod:"NÃ¡stroj / ZbraÅˆ",quantity:"PoÄet",ecoQuantity:"PoÄet",cost:"Cena",ecoCost:"MateriÃ¡l",items:{rocket:"Raketa",c4:"C4",hv:"HV Raketa",incen:"ZÃ¡palnÃ¡ Raketa",exp556:"ExplozivnÃ­ 5.56",satchel:"Satchel Charge",beancan:"Beancan",molotov:"Molotov",hatchet:"Sekera (Hatchet)",pickaxe:"KrumpÃ¡Ä (Pickaxe)",spear:"DÅ™evÄ›nÃ½ oÅ¡tÄ›p",sword:"Salvaged Sword",jackhammer:"Jackhammer",fireArrow:"ZÃ¡palnÃ½ Å¡Ã­p",charcoal:"UhlÃ­",frags:"Fragmenty",fuel:"Palivo",pipe:"Trubka",tech:"Tech Trash",cloth:"LÃ¡tka",wood:"DÅ™evo"},targets:{woodDoor:"DÅ™evÄ›nÃ© DveÅ™e",woodDouble:"DÅ™evÄ›nÃ© DvojitÃ© DveÅ™e",woodWall:"DÅ™evÄ›nÃ¡ stÄ›na",stoneWall:"KamennÃ¡ stÄ›na / ZÃ¡klady",metalWall:"PlechovÃ¡ stÄ›na (Sheet)",armoredWall:"PancÃ©Å™ovÃ¡ stÄ›na (HQM)",sheetDoor:"PlechovÃ© dveÅ™e (Sheet)",sheetDouble:"PlechovÃ© DvojitÃ© DveÅ™e",garageDoor:"GarÃ¡Å¾ovÃ¡ vrata (Garage)",armoredDoor:"PancÃ©Å™ovÃ© dveÅ™e (Armored)",armoredDouble:"PancÃ©Å™ovÃ© DvojitÃ© DveÅ™e",highWood:"VysokÃ¡ dÅ™evÄ›nÃ¡ zeÄ",highStone:"VysokÃ¡ kamennÃ¡ zeÄ",turret:"Auto Turret",sam:"SAM Site",tc:"Tool Cupboard (TC)",softWood:"DÅ™evÄ›nÃ¡ zeÄ (MÄ›kkÃ¡ strana)",softStone:"KamennÃ¡ zeÄ (MÄ›kkÃ¡ strana)",mini:"Minicopter",scrappy:"Scrap Heli",camper:"Camper Module"} },
        ru: { tabCraft:"ÐšÑ€Ð°Ñ„Ñ‚",tabRaid:"Ð ÐµÐ¹Ð´",tabEco:"Ð­ÐºÐ¾ / Ð¡Ð¿ÐµÑ†",selectItem:"Ð§Ñ‚Ð¾ ÐºÑ€Ð°Ñ„Ñ‚Ð¸Ð¼?",enterSulfur:"ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð¡ÐµÑ€Ñ‹",calculateBtn:"Ð Ð°ÑÑÑ‡Ð¸Ñ‚Ð°Ñ‚ÑŒ",resetBtn:"Ð¡Ð±Ñ€Ð¾Ñ",youCanCraft:"ÐœÐ¾Ð¶Ð½Ð¾ ÑÐºÑ€Ð°Ñ„Ñ‚Ð¸Ñ‚ÑŒ:",sulfurManagement:"1. Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ ÑÐµÑ€Ð¾Ð¹",otherMaterials:"2. Ð¢Ñ€ÐµÐ±ÑƒÐµÐ¼Ñ‹Ðµ Ñ€ÐµÑÑƒÑ€ÑÑ‹",step1:"Ð’Ð¾Ð·ÑŒÐ¼Ð¸",step2:"Ð¡ÐºÑ€Ð°Ñ„Ñ‚Ð¸",step3:"ÐžÑÑ‚Ð°Ð²ÑŒ",step4:"Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹ Ð´Ð»Ñ",sulfurRaw:"Ð¡ÐµÑ€Ñ‹",gp:"ÐŸÐ¾Ñ€Ð¾Ñ…Ð°",explosives:"Ð’Ð·Ñ€Ñ‹Ð²Ñ‡Ð°Ñ‚ÐºÐ¸",inInventory:"Ð² Ð¸Ð½Ð²ÐµÐ½Ñ‚Ð°Ñ€Ðµ",leftover:"ÐžÑÑ‚Ð°Ñ‚Ð¾Ðº",useForAmmo:"ÐŸÑ€ÑÐ¼Ð¾ Ð² Ð¿Ð°Ñ‚Ñ€Ð¾Ð½Ñ‹",selectTarget:"Ð§Ñ‚Ð¾ Ð»Ð¾Ð¼Ð°ÐµÐ¼?",selectEcoTarget:"Ð¡Ð¿ÐµÑ†. Ñ†ÐµÐ»Ð¸",targetCountLabel:"ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ñ†ÐµÐ»ÐµÐ¹",raidOptions:"ÐœÐµÑ‚Ð¾Ð´Ñ‹ Ñ€ÐµÐ¹Ð´Ð°",ecoOptions:"Ð­ÐºÐ¾ Ð ÐµÐ¹Ð´",method:"ÐžÑ€ÑƒÐ¶Ð¸Ðµ",ecoMethod:"Ð˜Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚",quantity:"ÐšÐ¾Ð»-Ð²Ð¾",ecoQuantity:"ÐšÐ¾Ð»-Ð²Ð¾",cost:"Ð¡Ñ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ",ecoCost:"ÐœÐ°Ñ‚ÐµÑ€Ð¸Ð°Ð»Ñ‹",items:{rocket:"Ð Ð°ÐºÐµÑ‚Ð°",c4:"C4",hv:"HV Ð Ð°ÐºÐµÑ‚Ð°",incen:"Ð—Ð°Ð¶Ð¸Ð³. Ñ€Ð°ÐºÐµÑ‚Ð°",exp556:"Ð Ð°Ð·Ñ€Ñ‹Ð²Ð½Ñ‹Ðµ",satchel:"Ð¡Ð°Ñ‡ÐµÐ»ÑŒ",beancan:"Ð‘Ð¸Ð½ÐºÐ°Ð½",molotov:"ÐœÐ¾Ð»Ð¾Ñ‚Ð¾Ð²",hatchet:"Ð¢Ð¾Ð¿Ð¾Ñ€",pickaxe:"ÐšÐ¸Ñ€ÐºÐ°",spear:"ÐšÐ¾Ð¿ÑŒÐµ",sword:"ÐœÐµÑ‡",jackhammer:"ÐžÑ‚Ð±Ð¾Ð¹Ð½Ð¸Ðº",fireArrow:"ÐžÐ³Ð½ÐµÐ½Ð½Ð°Ñ ÑÑ‚Ñ€ÐµÐ»Ð°",charcoal:"Ð£Ð³Ð¾Ð»ÑŒ",frags:"Ð¤Ñ€Ð°Ð³Ð¼ÐµÐ½Ñ‚Ñ‹",fuel:"Ð¢Ð¾Ð¿Ð»ÐµÐ²Ð¾",pipe:"Ð¢Ñ€ÑƒÐ±Ð°",tech:"ÐœÐ¸ÐºÑ€Ð¾ÑÑ…ÐµÐ¼Ñ‹",cloth:"Ð¢ÐºÐ°Ð½ÑŒ",wood:"Ð”ÐµÑ€ÐµÐ²Ð¾"},targets:{woodDoor:"Ð”ÐµÑ€ÐµÐ²ÑÐ½Ð½Ð°Ñ Ð´Ð²ÐµÑ€ÑŒ",woodDouble:"Ð”ÐµÑ€ÐµÐ²ÑÐ½Ð½Ð°Ñ Ð´Ð²Ð¾Ð¹Ð½Ð°Ñ",woodWall:"Ð”ÐµÑ€ÐµÐ²ÑÐ½Ð½Ð°Ñ ÑÑ‚ÐµÐ½Ð°",stoneWall:"ÐšÐ°Ð¼ÐµÐ½Ð½Ð°Ñ ÑÑ‚ÐµÐ½Ð°",metalWall:"ÐœÐµÑ‚Ð°Ð»Ð»Ð¸Ñ‡ÐµÑÐºÐ°Ñ ÑÑ‚ÐµÐ½Ð°",armoredWall:"ÐœÐ’Ðš ÑÑ‚ÐµÐ½Ð°",sheetDoor:"ÐœÐµÑ‚Ð°Ð»Ð»Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð´Ð²ÐµÑ€ÑŒ",sheetDouble:"ÐœÐµÑ‚Ð°Ð»Ð»Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð´Ð²Ð¾Ð¹Ð½Ð°Ñ",garageDoor:"Ð“Ð°Ñ€Ð°Ð¶Ð½Ð°Ñ Ð´Ð²ÐµÑ€ÑŒ",armoredDoor:"ÐœÐ’Ðš Ð´Ð²ÐµÑ€ÑŒ",armoredDouble:"ÐœÐ’Ðš Ð´Ð²Ð¾Ð¹Ð½Ð°Ñ",highWood:"Ð’Ñ‹ÑÐ¾ÐºÐ°Ñ Ð´ÐµÑ€ÐµÐ²ÑÐ½Ð½Ð°Ñ",highStone:"Ð’Ñ‹ÑÐ¾ÐºÐ°Ñ ÐºÐ°Ð¼ÐµÐ½Ð½Ð°Ñ",turret:"Ð¢ÑƒÑ€ÐµÐ»ÑŒ",sam:"ÐŸÐ’Ðž (SAM)",tc:"Ð¨ÐºÐ°Ñ„ (TC)",softWood:"Ð”ÐµÑ€ÐµÐ²Ð¾ (Soft Side)",softStone:"ÐšÐ°Ð¼ÐµÐ½ÑŒ (Soft Side)",mini:"ÐšÐ¾Ð¿Ñ‚ÐµÑ€",scrappy:"ÐšÐ¾Ñ€Ð¾Ð²Ð°",camper:"ÐšÐµÐ¼Ð¿ÐµÑ€"} },
        zh: { tabCraft:"åˆ¶ä½œ",tabRaid:"æ‹†å®¶",tabEco:"çŽ¯ä¿ / ç‰¹æ®Š",selectItem:"ä½ æƒ³åˆ¶é€ ä»€ä¹ˆï¼Ÿ",enterSulfur:"ç¡«ç£ºæ€»é‡",calculateBtn:"è®¡ç®—",resetBtn:"é‡ç½®",youCanCraft:"ä½ å¯ä»¥åˆ¶é€ ï¼š",sulfurManagement:"1. ç¡«ç£ºåˆ†é…",otherMaterials:"2. å…¶ä»–æ‰€éœ€ææ–™",step1:"å–å‡º",step2:"åˆ¶ä½œæˆ",step3:"ä¿ç•™",step4:"ç”¨äºŽåˆ¶ä½œ",sulfurRaw:"ç¡«ç£º",gp:"ç«è¯",explosives:"ç‚¸è¯",inInventory:"åœ¨èƒŒåŒ…ä¸­",leftover:"å‰©ä½™",useForAmmo:"ç›´æŽ¥ç”¨äºŽå¼¹è¯",selectTarget:"ç›®æ ‡å»ºç­‘",selectEcoTarget:"ç‰¹æ®Šç›®æ ‡",targetCountLabel:"ç›®æ ‡æ•°é‡",raidOptions:"æ‹†é™¤æ–¹æ³•",ecoOptions:"çŽ¯ä¿æ‹†å®¶",method:"æ­¦å™¨",ecoMethod:"å·¥å…·",quantity:"æ•°é‡",ecoQuantity:"æ•°é‡",cost:"æˆæœ¬",ecoCost:"ææ–™",items:{rocket:"ç«ç®­",c4:"C4",hv:"é«˜é€Ÿç«ç®­",incen:"ç‡ƒçƒ§ç«ç®­",exp556:"çˆ†ç‚¸å¼¹è¯",satchel:"ç‚¸è¯åŒ…",beancan:"è±†ç½é›·",molotov:"ç‡ƒçƒ§ç“¶",hatchet:"æ–§å¤´",pickaxe:"ç¨¿å­",spear:"æœ¨çŸ›",sword:"å¤§ç åˆ€",jackhammer:"ç”µé’»",fireArrow:"ç«ç®­",charcoal:"æœ¨ç‚­",frags:"é‡‘å±žç¢Žç‰‡",fuel:"ä½Žçº§ç‡ƒæ–™",pipe:"é‡‘å±žç®¡",tech:"ç§‘æŠ€é›¶ä»¶",cloth:"å¸ƒ",wood:"æœ¨å¤´"},targets:{woodDoor:"æœ¨é—¨",woodDouble:"åŒæ‰‡æœ¨é—¨",woodWall:"æœ¨å¢™",stoneWall:"çŸ³å¢™",metalWall:"é“å¢™",armoredWall:"åˆé‡‘å¢™",sheetDoor:"é“é—¨",sheetDouble:"åŒæ‰‡é“é—¨",garageDoor:"å·å¸˜é—¨",armoredDoor:"åˆé‡‘é—¨",armoredDouble:"åŒæ‰‡åˆé‡‘é—¨",highWood:"é«˜å¤–æœ¨å¢™",highStone:"é«˜å¤–çŸ³å¢™",turret:"è‡ªåŠ¨ç‚®å¡”",sam:"é˜²ç©ºå¯¼å¼¹",tc:"é¢†åœ°æŸœ (TC)",softWood:"æœ¨å¢™ (è½¯é¢)",softStone:"çŸ³å¢™ (è½¯é¢)",mini:"ç›´å‡æœº",scrappy:"åºŸæ–™ç›´å‡æœº",camper:"æˆ¿è½¦æ¨¡å—"} }
    };

    // --- DATA ---
    const recipes = {
        rocket: { id: "rocket", wb: 3, scrap: 125, sulfurTotal: 1400, gpPerItem: 650, explosivesPerItem: 10, rawSulfurToKeep: 100, imgUrl: "https://rustlabs.com/img/items180/ammo.rocket.basic.png", other: [{id:"charcoal", amount:1950},{id:"frags", amount:100},{id:"fuel", amount:30},{id:"pipe", amount:2}] },
        c4: { id: "c4", wb: 3, scrap: 500, sulfurTotal: 2200, gpPerItem: 1000, explosivesPerItem: 20, rawSulfurToKeep: 200, imgUrl: "https://rustlabs.com/img/items180/explosive.timed.png", other: [{id:"charcoal", amount:3000},{id:"frags", amount:200},{id:"fuel", amount:60},{id:"tech", amount:2},{id:"cloth", amount:5}] },
        satchel: { id: "satchel", wb: 1, scrap: 125, sulfurTotal: 480, gpPerItem: 240, explosivesPerItem: 0, rawSulfurToKeep: 0, imgUrl: "https://rustlabs.com/img/items180/explosive.satchel.png", other: [{id:"charcoal", amount:720}, {id:"frags", amount:80}, {id:"cloth", amount:10}, {id:"rope", amount:1}] },
        exp556: { id: "exp556", wb: 3, scrap: 125, sulfurTotal: 25, gpPerItem: 10, explosivesPerItem: 0, rawSulfurToKeep: 5, imgUrl: "https://rustlabs.com/img/items180/ammo.rifle.explosive.png", other: [{id:"frags", amount:5}, {id:"charcoal", amount:30}] }, 
        hv: { id: "hv", wb: 2, scrap: 125, sulfurTotal: 200, gpPerItem: 100, explosivesPerItem: 0, rawSulfurToKeep: 0, imgUrl: "https://rustlabs.com/img/items180/ammo.rocket.hv.png", other: [{id:"charcoal", amount:300},{id:"pipe", amount:1}] },
        incen: { id: "incen", wb: 2, scrap: 125, sulfurTotal: 610, gpPerItem: 300, explosivesPerItem: 1, rawSulfurToKeep: 10, imgUrl: "https://rustlabs.com/img/items180/ammo.rocket.fire.png", other: [{id:"charcoal", amount:900}, {id:"fuel", amount:253}, {id:"frags", amount:10}, {id:"pipe", amount:2}] },
        beancan: { id: "beancan", wb: 1, scrap: 75, sulfurTotal: 120, gpPerItem: 60, explosivesPerItem: 0, rawSulfurToKeep: 0, imgUrl: "https://rustlabs.com/img/items180/grenade.beancan.png", other: [] },
        molotov: { id: "molotov", wb: 2, scrap: 75, sulfurTotal: 0, gpPerItem: 0, explosivesPerItem: 0, rawSulfurToKeep: 0, imgUrl: "https://rustlabs.com/img/items180/grenade.molotov.png", other: [{id:"cloth", amount:10},{id:"fuel", amount:50}] },
        // Eco Tools
        hatchet: { id: "hatchet", sulfurTotal: 0, imgUrl: "https://rustlabs.com/img/items180/hatchet.png", other: [{id:"wood", amount:100}, {id:"frags", amount:75}] },
        pickaxe: { id: "pickaxe", sulfurTotal: 0, imgUrl: "https://rustlabs.com/img/items180/pickaxe.png", other: [{id:"wood", amount:100}, {id:"frags", amount:125}] },
        spear: { id: "spear", sulfurTotal: 0, imgUrl: "https://rustlabs.com/img/items180/spear.wooden.png", other: [{id:"wood", amount:300}] },
        sword: { id: "sword", sulfurTotal: 0, imgUrl: "https://rustlabs.com/img/items180/salvaged.sword.png", other: [{id:"frags", amount:15}, {id:"blade", amount:1}] },
        jackhammer: { id: "jackhammer", sulfurTotal: 0, imgUrl: "https://rustlabs.com/img/items180/jackhammer.png", other: [] },
        fireArrow: { id: "fireArrow", sulfurTotal: 0, imgUrl: "https://rustlabs.com/img/items180/arrow.fire.png", other: [{id:"cloth", amount:2}, {id:"fuel", amount:2}] } 
    };

    const raidTargets = {
        woodDoor: { hp: 200, imgUrl: "https://rustlabs.com/img/items180/door.hinged.wood.png", methods: { satchel: 2, molotov: 2, exp556: 19, beancan: 6, c4: 1 } },
        woodDouble: { hp: 200, imgUrl: "https://rustlabs.com/img/items180/door.double.hinged.wood.png", methods: { satchel: 2, molotov: 2, exp556: 19, beancan: 6, c4: 1 } },
        woodWall: { hp: 250, imgUrl: "https://rustlabs.com/img/items180/wood.png", methods: { rocket: 2, molotov: 4, satchel: 3, exp556: 49, c4: 1 } },
        stoneWall: { hp: 500, imgUrl: "https://rustlabs.com/img/items180/stones.png", methods: { rocket: 4, satchel: 10, exp556: 185, c4: 2 } },
        metalWall: { hp: 1000, imgUrl: "https://rustlabs.com/img/items180/metal.fragments.png", methods: { rocket: 8, satchel: 23, exp556: 400, c4: 4 } },
        armoredWall: { hp: 2000, imgUrl: "https://rustlabs.com/img/items180/metal.refined.png", methods: { rocket: 15, satchel: 46, exp556: 799, c4: 8 } },
        sheetDoor: { hp: 250, imgUrl: "https://rustlabs.com/img/items180/door.hinged.metal.png", methods: { rocket: 1, satchel: 4, exp556: 63, c4: 1 } },
        sheetDouble: { hp: 250, imgUrl: "https://rustlabs.com/img/items180/door.double.hinged.metal.png", methods: { rocket: 1, satchel: 4, exp556: 63, c4: 1 } },
        garageDoor: { hp: 600, imgUrl: "https://rustlabs.com/img/items180/wall.frame.garagedoor.png", methods: { rocket: 3, satchel: 9, exp556: 150, c4: 2 } },
        armoredDoor: { hp: 1000, imgUrl: "https://rustlabs.com/img/items180/door.hinged.toptier.png", methods: { rocket: 5, satchel: 15, exp556: 250, c4: 3 } },
        armoredDouble: { hp: 1000, imgUrl: "https://rustlabs.com/img/items180/door.double.hinged.toptier.png", methods: { rocket: 5, satchel: 15, exp556: 250, c4: 3 } },
        highWood: { hp: 500, imgUrl: "https://rustlabs.com/img/items180/wall.external.high.png", methods: { rocket: 3, molotov: 4, satchel: 6, exp556: 98, c4: 2 } },
        highStone: { hp: 500, imgUrl: "https://rustlabs.com/img/items180/wall.external.high.stone.png", methods: { rocket: 4, satchel: 10, exp556: 185, c4: 2 } },
        turret: { hp: 1000, imgUrl: "https://rustlabs.com/img/items180/autoturret.png", methods: { hv: 3, satchel: 2, exp556: 102, rocket: 1 } },
        sam: { hp: 1000, imgUrl: "https://rustlabs.com/img/items180/samsite.png", methods: { hv: 3, satchel: 2, exp556: 102, rocket: 1 } }
    };

    const ecoTargets = {
        tc: { imgUrl: "https://rustlabs.com/img/items180/cupboard.tool.png", methods: { hatchet: 5, satchel: 2, exp556: 100, fireArrow: 40 } },
        softWood: { imgUrl: "https://rustlabs.com/img/items180/wood.png", methods: { spear: 24, sword: 6, hatchet: 4 } },
        softStone: { imgUrl: "https://rustlabs.com/img/items180/stones.png", methods: { pickaxe: 7, jackhammer: 2, spear: 236 } },
        mini: { imgUrl: "https://rustlabs.com/img/items180/minicopter.png", methods: { hv: 2, exp556: 121, fireArrow: 65, rocket: 1 } },
        scrappy: { imgUrl: "https://wiki.rustclash.com/img/screenshots/scrap-heli.png", methods: { hv: 3, rocket: 2, exp556: 200 } },
        camper: { imgUrl: "https://wiki.rustclash.com/img/items180/vehicle.2mod.camper.png", methods: { rocket: 2, satchel: 10, c4: 1 } }
    };

    // --- APP LOGIC ---
    let currentLang = "en";

    function setLang(lang) {
        currentLang = lang;
        localStorage.setItem('rust_lang', lang);
        document.querySelectorAll('.flag-btn').forEach(btn => btn.classList.remove('active'));
        document.getElementById('btn-' + lang).classList.add('active');
        updateUI();
        // Refresh calculations
        if(document.getElementById('view-craft').classList.contains('active')) calculateCraft();
        if(document.getElementById('view-raid').classList.contains('active')) calculateRaid();
        if(document.getElementById('view-eco').classList.contains('active')) calculateEco();
    }

    function switchTab(tab) {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('t_tab' + (tab.charAt(0).toUpperCase() + tab.slice(1))).classList.add('active');
        document.querySelectorAll('.view-section').forEach(v => v.classList.remove('active'));
        document.getElementById('view-' + tab).classList.add('active');
    }

    function updateUI() {
        const t = translations[currentLang];
        // Texts update
        document.getElementById('t_tabCraft').innerText = t.tabCraft;
        document.getElementById('t_tabRaid').innerText = t.tabRaid;
        document.getElementById('t_tabEco').innerText = t.tabEco;
        document.getElementById('t_selectItem').innerText = t.selectItem;
        document.getElementById('t_enterSulfur').innerText = t.enterSulfur;
        document.getElementById('t_calculateBtn').innerText = t.calculateBtn;
        document.getElementById('t_resetBtn').innerText = t.resetBtn;
        document.getElementById('t_youCanCraft').innerText = t.youCanCraft;
        document.getElementById('t_sulfurManagement').innerText = t.sulfurManagement;
        document.getElementById('t_otherMaterials').innerText = t.otherMaterials;
        document.getElementById('t_step1').innerText = t.step1;
        document.getElementById('t_step2').innerText = t.step2;
        document.getElementById('t_step3').innerText = t.step3;
        document.getElementById('t_sulfurRaw').innerText = t.sulfurRaw;
        document.getElementById('t_sulfurRaw2').innerText = t.sulfurRaw;
        document.getElementById('t_gp').innerText = t.gp;
        document.getElementById('t_inInventory').innerText = t.inInventory;
        document.getElementById('t_selectTarget').innerText = t.selectTarget;
        document.getElementById('t_targetCountLabel').innerText = t.targetCountLabel;
        document.getElementById('t_raidOptions').innerText = t.raidOptions;
        document.getElementById('t_method').innerText = t.method;
        document.getElementById('t_quantity').innerText = t.quantity;
        document.getElementById('t_cost').innerText = t.cost;
        document.getElementById('t_selectEcoTarget').innerText = t.selectEcoTarget;
        document.getElementById('t_ecoOptions').innerText = t.ecoOptions;
        document.getElementById('t_ecoMethod').innerText = t.ecoMethod;
        document.getElementById('t_ecoQuantity').innerText = t.ecoQuantity;
        document.getElementById('t_ecoCost').innerText = t.ecoCost;

        populateSelects(t);
    }

    function populateSelects(t) {
        // Craft Select
        const craftSel = document.getElementById('itemType');
        const craftVal = craftSel.value;
        craftSel.innerHTML = "";
        for (const [key, value] of Object.entries(recipes)) {
            if(value.sulfurTotal > 0 || value.scrap > 0) { // Only craftables
                const opt = document.createElement('option');
                opt.value = key;
                opt.innerText = t.items[value.id] || value.id;
                craftSel.appendChild(opt);
            }
        }
        if (craftVal && recipes[craftVal]) craftSel.value = craftVal;
        updateTechInfo();

        // Raid Select
        const raidSel = document.getElementById('targetType');
        const raidVal = raidSel.value;
        raidSel.innerHTML = "";
        for (const [key, value] of Object.entries(raidTargets)) {
            const opt = document.createElement('option');
            opt.value = key;
            opt.innerText = t.targets[key] || key;
            raidSel.appendChild(opt);
        }
        if (raidVal && raidTargets[raidVal]) raidSel.value = raidVal;

        // Eco Select
        const ecoSel = document.getElementById('ecoTargetType');
        const ecoVal = ecoSel.value;
        ecoSel.innerHTML = "";
        for (const [key, value] of Object.entries(ecoTargets)) {
            const opt = document.createElement('option');
            opt.value = key;
            opt.innerText = t.targets[key] || key;
            ecoSel.appendChild(opt);
        }
        if (ecoVal && ecoTargets[ecoVal]) ecoSel.value = ecoVal;
    }

    function updateTechInfo() {
        const type = document.getElementById('itemType').value;
        const recipe = recipes[type];
        const container = document.getElementById('techInfoDisplay');
        if(!recipe || !recipe.wb) { container.innerHTML = ''; return; }
        container.innerHTML = `<span class="badge badge-wb${recipe.wb}">Level ${recipe.wb} WB</span><span class="badge badge-scrap">${recipe.scrap} Scrap</span>`;
    }

    function onCraftItemChange() {
        updateTechInfo();
        const sulfurVal = document.getElementById('sulfur').value;
        // If user already entered sulfur, recalc immediately
        if(sulfurVal && sulfurVal > 0) {
            calculateCraft();
        }
    }

    function resetCraft() {
        document.getElementById('sulfur').value = "";
        document.getElementById('craftResult').style.display = 'none';
    }

    function calculateCraft() {
        const sulfurInput = parseInt(document.getElementById('sulfur').value);
        const type = document.getElementById('itemType').value;
        const recipe = recipes[type];
        const t = translations[currentLang];
        
        if (isNaN(sulfurInput) || sulfurInput <= 0) return;
        
        // Safety check for non-sulfur items in list
        if (recipe.sulfurTotal === 0) { 
            // Should be handled by list filter, but just in case
            return; 
        }

        const maxItems = Math.floor(sulfurInput / recipe.sulfurTotal);
        if (maxItems === 0) { alert(`Not enough Sulfur!`); return; }
        
        const totalGP = maxItems * recipe.gpPerItem;
        const sulfurForGP = totalGP * 2;
        const totalExp = maxItems * recipe.explosivesPerItem;
        const sulfurReserved = maxItems * recipe.rawSulfurToKeep;
        
        document.getElementById('resultImage').src = recipe.imgUrl;
        let countText = maxItems + " x " + (t.items[recipe.id] || recipe.id);
        if(recipe.id === 'exp556') countText += ` (${maxItems * 2} bullets)`; // 2 bullets per craft!
        
        document.getElementById('finalCount').innerText = countText;
        const leftover = sulfurInput - (maxItems * recipe.sulfurTotal);
        document.getElementById('itemNameDisplay').innerText = `(${t.leftover}: ${leftover})`;
        
        document.getElementById('sulfurToGP').innerText = sulfurForGP.toLocaleString();
        document.getElementById('gpCount').innerText = totalGP.toLocaleString();
        
        const expBox = document.getElementById('expInstructionBox');
        if (recipe.rawSulfurToKeep > 0) {
            expBox.style.display = 'block';
            document.getElementById('sulfurToKeep').innerText = sulfurReserved.toLocaleString();
            document.getElementById('t_step4').innerText = recipe.explosivesPerItem > 0 ? t.step4 : t.useForAmmo;
            document.getElementById('expCount').innerText = recipe.explosivesPerItem > 0 ? totalExp.toLocaleString() : "";
            document.getElementById('expLabel').innerText = recipe.explosivesPerItem > 0 ? " " + t.explosives : "";
        } else {
            expBox.style.display = 'none';
        }
        
        const listEl = document.getElementById('materialsList');
        listEl.innerHTML = "";
        if(recipe.other) {
            recipe.other.forEach(mat => {
                const totalNeeded = mat.amount * maxItems;
                const li = document.createElement('li');
                li.innerHTML = `<span>${t.items[mat.id] || mat.id}</span> <span class="val">${totalNeeded.toLocaleString()}</span>`;
                listEl.appendChild(li);
            });
        }
        document.getElementById('craftResult').style.display = 'block';
    }

    function calculateRaid() {
        const targetKey = document.getElementById('targetType').value;
        const count = Math.max(1, parseInt(document.getElementById('targetCount').value) || 1);
        const target = raidTargets[targetKey];
        const t = translations[currentLang];
        
        const imgEl = document.getElementById('raidTargetImage');
        if(target.imgUrl) { imgEl.src = target.imgUrl; imgEl.style.display = 'block'; } else { imgEl.style.display = 'none'; }

        const tbody = document.getElementById('raidTableBody');
        tbody.innerHTML = "";
        let methods = [];
        
        for (const [weaponKey, amountPerOne] of Object.entries(target.methods)) {
            const recipe = recipes[weaponKey];
            if (!recipe) continue;
            
            const totalAmount = amountPerOne * count;
            const totalSulfur = totalAmount * recipe.sulfurTotal;
            methods.push({ key: weaponKey, name: t.items[weaponKey] || weaponKey, amount: totalAmount, cost: totalSulfur, img: recipe.imgUrl });
        }
        
        methods.sort((a, b) => {
             if (a.cost === 0 && b.cost > 0) return -1;
             if (a.cost > 0 && b.cost === 0) return 1;
             return a.cost - b.cost;
        });

        methods.forEach(m => {
            const tr = document.createElement('tr');
            let costDisplay;
            // Show resources for 0 sulfur items (Molotovs)
            if (m.cost === 0 && recipes[m.key].other) {
                let mats = [];
                recipes[m.key].other.forEach(mat => {
                    mats.push(`${(mat.amount * m.amount).toLocaleString()} ${t.items[mat.id] || mat.id}`);
                });
                costDisplay = `<span class="resource-cost">${mats.join(', ')}</span>`;
            } else {
                costDisplay = `<span class="sulfur-cost">${m.cost.toLocaleString()} Sulfur</span>`;
            }
            tr.innerHTML = `<td><div class="raid-method-flex"><img src="${m.img}" class="raid-method-icon"><span>${m.name}</span></div></td><td class="item-count">${m.amount}</td><td>${costDisplay}</td>`;
            tbody.appendChild(tr);
        });
    }

    function calculateEco() {
        const targetKey = document.getElementById('ecoTargetType').value;
        const target = ecoTargets[targetKey];
        const t = translations[currentLang];
        
        const imgEl = document.getElementById('ecoTargetImage');
        if(target.imgUrl) { imgEl.src = target.imgUrl; imgEl.style.display = 'block'; } else { imgEl.style.display = 'none'; }

        const tbody = document.getElementById('ecoTableBody');
        tbody.innerHTML = "";
        let methods = [];
        for (const [weaponKey, amount] of Object.entries(target.methods)) {
            const recipe = recipes[weaponKey];
            if (!recipe) continue;
            methods.push({ 
                key: weaponKey, 
                name: t.items[weaponKey] || weaponKey, 
                amount: amount, 
                sulfurCost: amount * recipe.sulfurTotal,
                isTool: recipe.sulfurTotal === 0,
                img: recipe.imgUrl 
            });
        }
        
        methods.sort((a, b) => {
            if (a.sulfurCost === 0 && b.sulfurCost > 0) return -1;
            if (a.sulfurCost > 0 && b.sulfurCost === 0) return 1;
            return a.sulfurCost - b.sulfurCost;
        });

        methods.forEach(m => {
            const tr = document.createElement('tr');
            let costDisplay = "";
            if (m.isTool) {
                let mats = [];
                recipes[m.key].other.forEach(mat => {
                    let totalMat = mat.amount * m.amount;
                    mats.push(`<span class="resource-highlight">${totalMat.toLocaleString()}</span> ${t.items[mat.id] || mat.id}`);
                });
                costDisplay = `<span class="resource-cost">${mats.join(', ')}</span>`;
            } else {
                costDisplay = `<span class="sulfur-cost">${m.sulfurCost.toLocaleString()} Sulfur</span>`;
            }
            tr.innerHTML = `<td><div class="raid-method-flex"><img src="${m.img}" class="raid-method-icon"><span>${m.name}</span></div></td><td class="item-count">${m.amount}</td><td>${costDisplay}</td>`;
            tbody.appendChild(tr);
        });
    }

    // --- SW UPDATE LOGIC ---
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('./sw.js').then(reg => {
                if (reg.waiting) { showUpdateNotification(reg.waiting); return; }
                reg.addEventListener('updatefound', () => {
                    const newWorker = reg.installing;
                    newWorker.addEventListener('statechange', () => {
                        if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                            showUpdateNotification(newWorker);
                        }
                    });
                });
            });
            let refreshing;
            navigator.serviceWorker.addEventListener('controllerchange', () => {
                if (refreshing) return;
                window.location.reload();
                refreshing = true;
            });
        });
    }

    function showUpdateNotification(worker) {
        const notification = document.getElementById('updateNotification');
        const btn = document.getElementById('updateBtn');
        notification.style.display = 'block';
        btn.addEventListener('click', () => {
            worker.postMessage({ type: 'SKIP_WAITING' });
            btn.disabled = true;
            btn.innerText = "Updating...";
        });
    }

    // --- INIT ---
    const savedLang = localStorage.getItem('rust_lang');
    setLang(savedLang || 'en');

</script>
</body>
</html>
