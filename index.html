<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Boom & Doom</title>
    
    <meta name="description" content="Boom & Doom: Rust Raid & Crafting Calculator. Eco Raids, Tech Tree costs.">
    <meta property="og:title" content="Boom & Doom">
    <meta property="og:description" content="Spoƒç√≠tej si raid. Napl√°nuj zk√°zu. Eco raid, Soft side, Vehicles.">
    <meta property="og:type" content="website">

    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#8a1c1c">
    <link rel="icon" type="image/png" href="img/icon-192.png">
    <link rel="apple-touch-icon" href="img/icon-192.png">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/lipis/flag-icons@6.11.0/css/flag-icons.min.css"/>
    
    <style>
        :root {
            --bg-color: #121212;
            --panel-color: #1e1e1e;
            --accent-color: #d32f2f;
            --btn-color: #c62828;
            --btn-hover: #e53935;
            --btn-reset: #424242;
            --text-color: #e0e0e0;
            --eco-color: #4caf50;
            --wb1: #72bb53; 
            --wb2: #5bb0ff; 
            --wb3: #ff5b5b; 
            --scrap: #a8a39d;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            justify-content: center;
            padding: 20px;
            margin: 0;
            min-height: 100vh;
        }
        .container {
            background-color: var(--panel-color);
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 25px rgba(0,0,0,0.8);
            max-width: 600px;
            width: 100%;
            display: flex;
            flex-direction: column;
            border-top: 4px solid var(--accent-color);
            position: relative;
        }
        
        /* HEADER LAYOUT */
        .header-top {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 25px;
            gap: 15px;
        }
        .title-wrapper { display: flex; align-items: center; justify-content: center; gap: 15px; }
        .app-logo { width: 45px; height: 45px; border-radius: 10px; box-shadow: 0 0 10px rgba(211, 47, 47, 0.3); }
        h1 { color: var(--accent-color); margin: 0; font-size: 1.8rem; text-transform: uppercase; letter-spacing: 2px; font-weight: 800; text-shadow: 0 0 15px rgba(211, 47, 47, 0.4); white-space: nowrap; }
        .lang-buttons { display: flex; gap: 8px; }

        @media (min-width: 700px) {
            .header-top { display: grid; grid-template-columns: 1fr auto 1fr; align-items: start; margin-bottom: 10px; }
            .title-wrapper { grid-column: 2; margin-top: 15px; }
            .lang-buttons { grid-column: 3; justify-self: end; margin-top: -15px; }
        }

        .flag-btn { background: #141414; border: 2px solid #444; border-radius: 50%; cursor: pointer; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; transition: 0.2s; overflow: hidden; padding: 0; filter: grayscale(100%); }
        .flag-btn span { font-size: 24px; line-height: 1em; }
        .flag-btn:hover, .flag-btn.active { filter: grayscale(0%); border-color: var(--accent-color); transform: scale(1.1); }
        
        /* TABS */
        .tabs { display: flex; margin-bottom: 20px; background: #000; border-radius: 6px; padding: 5px; gap: 5px; }
        .tab-btn { flex: 1; padding: 12px 5px; background: transparent; border: none; color: #666; font-weight: bold; text-transform: uppercase; cursor: pointer; border-radius: 4px; transition: 0.2s; font-size: 0.9em; }
        .tab-btn.active { background: var(--accent-color); color: white; box-shadow: 0 0 10px rgba(211, 47, 47, 0.4); }
        .tab-btn#t_tabEco.active { background: var(--eco-color); box-shadow: 0 0 10px rgba(76, 175, 80, 0.4); }
        
        .view-section { display: none; animation: fadeIn 0.3s ease-in-out; }
        .view-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        label { display: block; margin-bottom: 8px; font-weight: bold; margin-top: 15px; font-size: 0.9em; color: #aaa;}
        input, select { width: 100%; padding: 12px; background-color: #0a0a0a; border: 1px solid #333; color: white; border-radius: 4px; font-size: 16px; box-sizing: border-box; }
        
        .btn-group { display: flex; gap: 10px; margin-top: 25px; }
        button.calc-btn { flex: 2; padding: 15px; background-color: var(--btn-color); color: white; border: none; border-radius: 4px; font-size: 18px; cursor: pointer; font-weight: bold; text-transform: uppercase; transition: 0.2s; box-shadow: 0 4px 0 #8c1b1b; }
        button.calc-btn:hover { background-color: var(--btn-hover); transform: translateY(1px); box-shadow: 0 3px 0 #8c1b1b; }
        button.calc-btn:active { transform: translateY(4px); box-shadow: none; }
        button.reset-btn { flex: 1; padding: 15px; background-color: var(--btn-reset); color: #aaa; border: none; border-radius: 4px; font-size: 16px; cursor: pointer; font-weight: bold; text-transform: uppercase; transition: 0.2s; }
        button.reset-btn:hover { background-color: #555; color: white; }
        
        .result-box { margin-top: 25px; padding: 20px; background-color: #0a0a0a; border-left: 5px solid var(--accent-color); display: none; border-radius: 4px; }
        
        .raid-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        .raid-table th { text-align: left; color: #888; font-size: 0.8em; padding-bottom: 10px; border-bottom: 1px solid #333; }
        .raid-table td { padding: 12px 0; border-bottom: 1px solid #222; vertical-align: middle;}
        
        .raid-method-flex { display: flex; align-items: center; }
        .raid-method-icon { width: 28px; height: 28px; margin-right: 10px; object-fit: contain; }
        
        .sulfur-cost { color: #ffca28; font-weight: bold; font-size: 0.9em; }
        .item-count { font-size: 1.1em; font-weight: bold; color: #fff; }
        .resource-cost { color: #aaa; font-size: 0.85em; }
        .resource-highlight { color: #fff; font-weight: bold; }

        .item-image { display: block; margin: 0 auto 15px auto; max-width: 100px; height: auto; }
        .big-number { font-size: 1.5em; color: var(--accent-color); font-weight: bold; text-align: center; }
        .section-title { color: #888; text-transform: uppercase; font-size: 0.85em; margin-top: 20px; margin-bottom: 10px; border-bottom: 1px solid #333; padding-bottom: 5px;}
        
        ul { list-style-type: none; padding: 0; }
        ul li { background: #161616; margin-bottom: 5px; padding: 8px; border-radius: 4px; display: flex; justify-content: space-between; align-items: center;}
        .val { color: #fff; font-weight: bold; }
        
        .instruction { background-color: #1a1a1a; padding: 15px; border-radius: 5px; margin-bottom: 10px; border: 1px solid #333; line-height: 1.6; }
        .instruction span { color: #ef5350; font-weight: bold; }
        
        .tech-info { display: flex; justify-content: center; gap: 10px; margin-bottom: 15px; }
        .badge { padding: 4px 8px; border-radius: 4px; font-size: 0.8em; font-weight: bold; color: #fff; text-shadow: 1px 1px 0 #000; }
        .badge-wb1 { background-color: var(--wb1); }
        .badge-wb2 { background-color: var(--wb2); }
        .badge-wb3 { background-color: var(--wb3); }
        .badge-scrap { background-color: var(--scrap); color: #222; text-shadow: none; }

        #installBtn { display: none; width: 100%; padding: 10px; background-color: #333; color: #fff; border: 1px solid #555; border-radius: 4px; margin-bottom: 20px; cursor: pointer; text-align: center; font-size: 14px; }
        @media (min-width: 768px) { #installBtn { display: none !important; } }

        /* FOOTER DISCLAIMER */
        .footer {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #333;
            text-align: center;
            font-size: 0.75em;
            color: #666;
            line-height: 1.4;
        }
        .footer p { margin: 5px 0; }
        .footer a { color: #888; text-decoration: none; }
        .footer a:hover { color: #ccc; }
        /* UPDATE TOAST STYLING */
.update-toast {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    background-color: #222;
    border: 1px solid var(--accent-color);
    border-radius: 8px;
    padding: 15px 20px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.8);
    z-index: 1000;
    display: none; /* Skryt√©, dokud nen√≠ update */
    animation: slideUp 0.4s ease-out;
}

.update-content {
    display: flex;
    align-items: center;
    gap: 15px;
}

.update-content span {
    color: #fff;
    font-weight: bold;
}

#updateBtn {
    background-color: var(--accent-color);
    color: white;
    border: none;
    padding: 8px 12px;
    border-radius: 4px;
    cursor: pointer;
    font-weight: bold;
    text-transform: uppercase;
    font-size: 0.8em;
}

#updateBtn:hover {
    background-color: #ff5252;
}

@keyframes slideUp {
    from { transform: translate(-50%, 100px); opacity: 0; }
    to { transform: translate(-50%, 0); opacity: 1; }
}
    </style>
</head>
<body>
<div id="updateNotification" class="update-toast">
    <div class="update-content">
        <span>New version available!</span>
        <button id="updateBtn">Update Now</button>
    </div>
</div>    

<div class="container">
    <button id="installBtn">üì≤ Install App</button>

    <div class="header-top">
        <div class="title-wrapper">
            <img src="img/icon-192.png" alt="Logo" class="app-logo">
            <h1>Boom & Doom</h1>
        </div>
        <div class="lang-buttons">
            <button class="flag-btn active" onclick="setLang('en')" id="btn-en"><span class="fi fi-us"></span></button>
            <button class="flag-btn" onclick="setLang('cs')" id="btn-cs"><span class="fi fi-cz"></span></button>
            <button class="flag-btn" onclick="setLang('ru')" id="btn-ru"><span class="fi fi-ru"></span></button>
            <button class="flag-btn" onclick="setLang('zh')" id="btn-zh"><span class="fi fi-cn"></span></button>
        </div>
    </div>

    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('craft')" id="t_tabCraft">Crafting</button>
        <button class="tab-btn" onclick="switchTab('raid')" id="t_tabRaid">Raid Calc</button>
        <button class="tab-btn" onclick="switchTab('eco')" id="t_tabEco">Eco / Special</button>
    </div>

    <div id="view-craft" class="view-section active">
        <label for="itemType" id="t_selectItem">Select Item</label>
        <select id="itemType" onchange="onCraftItemChange()">
            </select>

        <label for="sulfur" id="t_enterSulfur">Sulfur Amount</label>
        <input type="number" id="sulfur" placeholder="50000">

        <div class="btn-group">
            <button onclick="calculateCraft()" id="t_calculateBtn" class="calc-btn">Calculate</button>
            <button onclick="resetCraft()" id="t_resetBtn" class="reset-btn">Reset</button>
        </div>

        <div id="craftResult" class="result-box">
            <img id="resultImage" src="" alt="Item" class="item-image">
            
            <div class="tech-info" id="techInfoDisplay"></div>

            <div style="text-align: center; margin-bottom: 20px;">
                <div id="t_youCanCraft">You can craft:</div>
                <div id="finalCount" class="big-number">0</div>
                <div id="itemNameDisplay" style="color:#aaa;"></div>
            </div>
            <div class="section-title" id="t_sulfurManagement">1. Sulfur Management</div>
            <div class="instruction">
                <span id="t_step1">Take</span> <span id="sulfurToGP">0</span> <span id="t_sulfurRaw">Sulfur</span>.<br>
                <span id="t_step2">Craft it into</span> <span id="gpCount">0</span> <span id="t_gp">Gunpowder</span>.
            </div>
            <div class="instruction" id="expInstructionBox">
                <span id="t_step3">Keep</span> <span id="sulfurToKeep">0</span> <span id="t_sulfurRaw2">Sulfur</span> <span id="t_inInventory">raw in inventory</span>.<br>
                <span id="t_step4">Use it to craft</span> <span id="expCount">0</span> <span id="expLabel">Explosives</span>.
            </div>
            <div class="section-title" id="t_otherMaterials">2. Other Materials Needed</div>
            <ul id="materialsList"></ul>
        </div>
    </div>

    <div id="view-raid" class="view-section">
        <label id="t_selectTarget">Select Target</label>
        <select id="targetType" onchange="calculateRaid()">
            </select>

        <label id="t_targetCountLabel">Number of Targets</label>
        <input type="number" id="targetCount" value="1" min="1" oninput="calculateRaid()">

        <div id="raidResult" class="result-box" style="display:block;">
            <img id="raidTargetImage" src="" alt="Target" class="item-image" style="display:none;">
            <div class="section-title" id="t_raidOptions">Recommended Methods</div>
            <table class="raid-table">
                <thead>
                    <tr>
                        <th id="t_method">Method</th>
                        <th id="t_quantity">Amount</th>
                        <th id="t_cost">Cost</th>
                    </tr>
                </thead>
                <tbody id="raidTableBody"></tbody>
            </table>
        </div>
    </div>

    <div id="view-eco" class="view-section">
        <label id="t_selectEcoTarget">Select Special Target</label>
        <select id="ecoTargetType" onchange="calculateEco()">
            </select>

        <div id="ecoResult" class="result-box" style="display:block; border-color: #4caf50;">
            <img id="ecoTargetImage" src="" alt="Target" class="item-image" style="display:none;">
            <div class="section-title" id="t_ecoOptions">Destruction Methods</div>
            <table class="raid-table">
                <thead>
                    <tr>
                        <th id="t_ecoMethod">Method</th>
                        <th id="t_ecoQuantity">Amount</th>
                        <th id="t_ecoCost">Materials Needed</th>
                    </tr>
                </thead>
                <tbody id="ecoTableBody"></tbody>
            </table>
        </div>
    </div>

    <div class="footer">
        <p>Boom & Doom is an unofficial tool. Not affiliated with Facepunch Studios.</p>
        <p>Game assets &copy; Facepunch Studios. Data source: RustLabs.</p>
    </div>

</div>

<script>
    // --- TRANSLATIONS ---
    const translations = {
        en: {
            tabCraft: "Crafting", tabRaid: "Raid", tabEco: "Eco / Special",
            selectItem: "What to craft?", enterSulfur: "Total Sulfur Amount", calculateBtn: "Calculate", resetBtn: "Reset",
            youCanCraft: "You can craft:", sulfurManagement: "1. Sulfur Management", otherMaterials: "2. Other Materials Needed",
            step1: "Take", step2: "Cook into", step3: "Keep", step4: "Use for",
            sulfurRaw: "Sulfur", gp: "Gunpowder", explosives: "Explosives", inInventory: "raw", leftover: "Leftover", useForAmmo: "Directly for Ammo",
            selectTarget: "Select Target to Destroy", selectEcoTarget: "Select Special Target", targetCountLabel: "Number of Targets",
            raidOptions: "Destruction Methods", ecoOptions: "Destruction Methods (Off-Meta)",
            method: "Weapon", ecoMethod: "Tool / Weapon", quantity: "Amount", ecoQuantity: "Amount", cost: "Total Cost", ecoCost: "Materials",
            items: {
                rocket: "Rocket", c4: "C4", hv: "HV Rocket", incen: "Incendiary Rocket",
                exp556: "Explosive Ammo", satchel: "Satchel Charge", beancan: "Beancan Grenade", molotov: "Molotov",
                hatchet: "Hatchet", pickaxe: "Pickaxe", spear: "Wooden Spear", sword: "Salvaged Sword", jackhammer: "Jackhammer", fireArrow: "Fire Arrow",
                charcoal: "Charcoal", frags: "Fragments", fuel: "LGF", pipe: "Pipe", tech: "Tech Trash", cloth: "Cloth", wood: "Wood"
            },
            targets: {
                woodDoor: "Wooden Door", woodDouble: "Wood Double Door", woodWall: "Wood Wall",
                stoneWall: "Stone Wall / Foundation", metalWall: "Sheet Metal Wall", armoredWall: "Armored Wall",
                sheetDoor: "Sheet Metal Door", sheetDouble: "Sheet Metal Double Door", garageDoor: "Garage Door",
                armoredDoor: "Armored Door", armoredDouble: "Armored Double Door", highWood: "High External Wood", highStone: "High External Stone",
                turret: "Auto Turret", sam: "SAM Site",
                tc: "Tool Cupboard (TC)", softWood: "Wood Wall (Soft Side)", softStone: "Stone Wall (Soft Side)",
                mini: "Minicopter", scrappy: "Scrap Heli", camper: "Camper Module"
            }
        },
        cs: {
            tabCraft: "V√Ωroba", tabRaid: "Raid", tabEco: "Eco / Special",
            selectItem: "Co chce≈° vyr√°bƒõt?", enterSulfur: "Mno≈æstv√≠ sulfuru", calculateBtn: "Spoƒç√≠tat", resetBtn: "Reset",
            youCanCraft: "M≈Ø≈æe≈° vyrobit:", sulfurManagement: "1. Mana≈æment Sulfuru", otherMaterials: "2. Dal≈°√≠ suroviny",
            step1: "Vezmi", step2: "Udƒõlej z nƒõj", step3: "Nech si", step4: "Pou≈æij na",
            sulfurRaw: "Sulfuru", gp: "Gunpowder", explosives: "Explosives", inInventory: "v invent√°≈ôi", leftover: "Zbytek", useForAmmo: "P≈ô√≠mo do n√°boj≈Ø",
            selectTarget: "Co chce≈° zniƒçit?", selectEcoTarget: "Co chce≈° zniƒçit? (Off-meta)", targetCountLabel: "Poƒçet c√≠l≈Ø",
            raidOptions: "Mo≈ænosti niƒçen√≠", ecoOptions: "Mo≈ænosti niƒçen√≠ (Off-Meta)",
            method: "Zbra≈à", ecoMethod: "N√°stroj / Zbra≈à", quantity: "Poƒçet", ecoQuantity: "Poƒçet", cost: "Cena", ecoCost: "Materi√°l",
            items: {
                rocket: "Raketa", c4: "C4", hv: "HV Raketa", incen: "Z√°paln√° Raketa",
                exp556: "Explozivn√≠ 5.56", satchel: "Satchel Charge", beancan: "Beancan", molotov: "Molotov",
                hatchet: "Sekera (Hatchet)", pickaxe: "Krump√°ƒç (Pickaxe)", spear: "D≈ôevƒõn√Ω o≈°tƒõp", sword: "Salvaged Sword", jackhammer: "Jackhammer", fireArrow: "Z√°paln√Ω ≈°√≠p",
                charcoal: "Uhl√≠", frags: "Fragmenty", fuel: "Palivo", pipe: "Trubka", tech: "Tech Trash", cloth: "L√°tka", wood: "D≈ôevo"
            },
            targets: {
                woodDoor: "D≈ôevƒõn√© Dve≈ôe", woodDouble: "D≈ôevƒõn√© Dvojit√© Dve≈ôe", woodWall: "D≈ôevƒõn√° stƒõna",
                stoneWall: "Kamenn√° stƒõna / Z√°klady", metalWall: "Plechov√° stƒõna (Sheet)", armoredWall: "Panc√©≈ôov√° stƒõna (HQM)",
                sheetDoor: "Plechov√© dve≈ôe (Sheet)", sheetDouble: "Plechov√© Dvojit√© Dve≈ôe", garageDoor: "Gar√°≈æov√° vrata (Garage)",
                armoredDoor: "Panc√©≈ôov√© dve≈ôe (Armored)", armoredDouble: "Panc√©≈ôov√© Dvojit√© Dve≈ôe", highWood: "Vysok√° d≈ôevƒõn√° zeƒè", highStone: "Vysok√° kamenn√° zeƒè",
                turret: "Auto Turret", sam: "SAM Site",
                tc: "Tool Cupboard (TC)", softWood: "D≈ôevƒõn√° zeƒè (Mƒõkk√° strana)", softStone: "Kamenn√° zeƒè (Mƒõkk√° strana)",
                mini: "Minicopter", scrappy: "Scrap Heli", camper: "Camper Module"
            }
        },
        ru: {
            tabCraft: "–ö—Ä–∞—Ñ—Ç", tabRaid: "–†–µ–π–¥", tabEco: "–≠–∫–æ / –°–ø–µ—Ü", selectItem: "–ß—Ç–æ –∫—Ä–∞—Ñ—Ç–∏–º?", enterSulfur: "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –°–µ—Ä—ã", calculateBtn: "–†–∞—Å—Å—á–∏—Ç–∞—Ç—å", resetBtn: "–°–±—Ä–æ—Å", youCanCraft: "–ú–æ–∂–Ω–æ —Å–∫—Ä–∞—Ñ—Ç–∏—Ç—å:", sulfurManagement: "1. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–æ–π", otherMaterials: "2. –¢—Ä–µ–±—É–µ–º—ã–µ —Ä–µ—Å—É—Ä—Å—ã", step1: "–í–æ–∑—å–º–∏", step2: "–°–∫—Ä–∞—Ñ—Ç–∏", step3: "–û—Å—Ç–∞–≤—å", step4: "–ò—Å–ø–æ–ª—å–∑—É–π –¥–ª—è", sulfurRaw: "–°–µ—Ä—ã", gp: "–ü–æ—Ä–æ—Ö–∞", explosives: "–í–∑—Ä—ã–≤—á–∞—Ç–∫–∏", inInventory: "–≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ", leftover: "–û—Å—Ç–∞—Ç–æ–∫", useForAmmo: "–ü—Ä—è–º–æ –≤ –ø–∞—Ç—Ä–æ–Ω—ã", selectTarget: "–ß—Ç–æ –ª–æ–º–∞–µ–º?", selectEcoTarget: "–°–ø–µ—Ü. —Ü–µ–ª–∏", targetCountLabel: "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ü–µ–ª–µ–π", raidOptions: "–ú–µ—Ç–æ–¥—ã —Ä–µ–π–¥–∞", ecoOptions: "–≠–∫–æ –†–µ–π–¥", method: "–û—Ä—É–∂–∏–µ", ecoMethod: "–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç", quantity: "–ö–æ–ª-–≤–æ", ecoQuantity: "–ö–æ–ª-–≤–æ", cost: "–°—Ç–æ–∏–º–æ—Å—Ç—å", ecoCost: "–ú–∞—Ç–µ—Ä–∏–∞–ª—ã",
            items: { rocket: "–†–∞–∫–µ—Ç–∞", c4: "C4", hv: "HV –†–∞–∫–µ—Ç–∞", incen: "–ó–∞–∂–∏–≥. —Ä–∞–∫–µ—Ç–∞", exp556: "–†–∞–∑—Ä—ã–≤–Ω—ã–µ", satchel: "–°–∞—á–µ–ª—å", beancan: "–ë–∏–Ω–∫–∞–Ω", molotov: "–ú–æ–ª–æ—Ç–æ–≤", hatchet: "–¢–æ–ø–æ—Ä", pickaxe: "–ö–∏—Ä–∫–∞", spear: "–ö–æ–ø—å–µ", sword: "–ú–µ—á", jackhammer: "–û—Ç–±–æ–π–Ω–∏–∫", fireArrow: "–û–≥–Ω–µ–Ω–Ω–∞—è —Å—Ç—Ä–µ–ª–∞", charcoal: "–£–≥–æ–ª—å", frags: "–§—Ä–∞–≥–º–µ–Ω—Ç—ã", fuel: "–¢–æ–ø–ª–µ–≤–æ", pipe: "–¢—Ä—É–±–∞", tech: "–ú–∏–∫—Ä–æ—Å—Ö–µ–º—ã", cloth: "–¢–∫–∞–Ω—å", wood: "–î–µ—Ä–µ–≤–æ" },
            targets: { woodDoor: "–î–µ—Ä–µ–≤—è–Ω–Ω–∞—è –¥–≤–µ—Ä—å", woodDouble: "–î–µ—Ä–µ–≤—è–Ω–Ω–∞—è –¥–≤–æ–π–Ω–∞—è", woodWall: "–î–µ—Ä–µ–≤—è–Ω–Ω–∞—è —Å—Ç–µ–Ω–∞", stoneWall: "–ö–∞–º–µ–Ω–Ω–∞—è —Å—Ç–µ–Ω–∞", metalWall: "–ú–µ—Ç–∞–ª–ª–∏—á–µ—Å–∫–∞—è —Å—Ç–µ–Ω–∞", armoredWall: "–ú–í–ö —Å—Ç–µ–Ω–∞", sheetDoor: "–ú–µ—Ç–∞–ª–ª–∏—á–µ—Å–∫–∞—è –¥–≤–µ—Ä—å", sheetDouble: "–ú–µ—Ç–∞–ª–ª–∏—á–µ—Å–∫–∞—è –¥–≤–æ–π–Ω–∞—è", garageDoor: "–ì–∞—Ä–∞–∂–Ω–∞—è –¥–≤–µ—Ä—å", armoredDoor: "–ú–í–ö –¥–≤–µ—Ä—å", armoredDouble: "–ú–í–ö –¥–≤–æ–π–Ω–∞—è", highWood: "–í—ã—Å–æ–∫–∞—è –¥–µ—Ä–µ–≤—è–Ω–Ω–∞—è", highStone: "–í—ã—Å–æ–∫–∞—è –∫–∞–º–µ–Ω–Ω–∞—è", turret: "–¢—É—Ä–µ–ª—å", sam: "–ü–í–û (SAM)", tc: "–®–∫–∞—Ñ (TC)", softWood: "–î–µ—Ä–µ–≤–æ (Soft Side)", softStone: "–ö–∞–º–µ–Ω—å (Soft Side)", mini: "–ö–æ–ø—Ç–µ—Ä", scrappy: "–ö–æ—Ä–æ–≤–∞", camper: "–ö–µ–º–ø–µ—Ä" }
        },
        zh: {
            tabCraft: "Âà∂‰Ωú", tabRaid: "ÊãÜÂÆ∂", tabEco: "ÁéØ‰øù / ÁâπÊÆä", selectItem: "‰Ω†ÊÉ≥Âà∂ÈÄ†‰ªÄ‰πàÔºü", enterSulfur: "Á°´Á£∫ÊÄªÈáè", calculateBtn: "ËÆ°ÁÆó", resetBtn: "ÈáçÁΩÆ", youCanCraft: "‰Ω†ÂèØ‰ª•Âà∂ÈÄ†Ôºö", sulfurManagement: "1. Á°´Á£∫ÂàÜÈÖç", otherMaterials: "2. ÂÖ∂‰ªñÊâÄÈúÄÊùêÊñô", step1: "ÂèñÂá∫", step2: "Âà∂‰ΩúÊàê", step3: "‰øùÁïô", step4: "Áî®‰∫éÂà∂‰Ωú", sulfurRaw: "Á°´Á£∫", gp: "ÁÅ´ËçØ", explosives: "ÁÇ∏ËçØ", inInventory: "Âú®ËÉåÂåÖ‰∏≠", leftover: "Ââ©‰Ωô", useForAmmo: "Áõ¥Êé•Áî®‰∫éÂºπËçØ", selectTarget: "ÁõÆÊ†áÂª∫Á≠ë", selectEcoTarget: "ÁâπÊÆäÁõÆÊ†á", targetCountLabel: "ÁõÆÊ†áÊï∞Èáè", raidOptions: "ÊãÜÈô§ÊñπÊ≥ï", ecoOptions: "ÁéØ‰øùÊãÜÂÆ∂", method: "Ê≠¶Âô®", ecoMethod: "Â∑•ÂÖ∑", quantity: "Êï∞Èáè", ecoQuantity: "Êï∞Èáè", cost: "ÊàêÊú¨", ecoCost: "ÊùêÊñô",
            items: { rocket: "ÁÅ´ÁÆ≠", c4: "C4", hv: "È´òÈÄüÁÅ´ÁÆ≠", incen: "ÁáÉÁÉßÁÅ´ÁÆ≠", exp556: "ÁàÜÁÇ∏ÂºπËçØ", satchel: "ÁÇ∏ËçØÂåÖ", beancan: "Ë±ÜÁΩêÈõ∑", molotov: "ÁáÉÁÉßÁì∂", hatchet: "ÊñßÂ§¥", pickaxe: "Á®øÂ≠ê", spear: "Êú®Áüõ", sword: "Â§ßÁ†çÂàÄ", jackhammer: "ÁîµÈíª", fireArrow: "ÁÅ´ÁÆ≠", charcoal: "Êú®ÁÇ≠", frags: "ÈáëÂ±ûÁ¢éÁâá", fuel: "‰ΩéÁ∫ßÁáÉÊñô", pipe: "ÈáëÂ±ûÁÆ°", tech: "ÁßëÊäÄÈõ∂‰ª∂", cloth: "Â∏É", wood: "Êú®Â§¥" },
            targets: { woodDoor: "Êú®Èó®", woodDouble: "ÂèåÊâáÊú®Èó®", woodWall: "Êú®Â¢ô", stoneWall: "Áü≥Â¢ô", metalWall: "ÈìÅÂ¢ô", armoredWall: "ÂêàÈáëÂ¢ô", sheetDoor: "ÈìÅÈó®", sheetDouble: "ÂèåÊâáÈìÅÈó®", garageDoor: "Âç∑Â∏òÈó®", armoredDoor: "ÂêàÈáëÈó®", armoredDouble: "ÂèåÊâáÂêàÈáëÈó®", highWood: "È´òÂ§ñÊú®Â¢ô", highStone: "È´òÂ§ñÁü≥Â¢ô", turret: "Ëá™Âä®ÁÇÆÂ°î", sam: "Èò≤Á©∫ÂØºÂºπ", tc: "È¢ÜÂú∞Êüú (TC)", softWood: "Êú®Â¢ô (ËΩØÈù¢)", softStone: "Áü≥Â¢ô (ËΩØÈù¢)", mini: "Áõ¥ÂçáÊú∫", scrappy: "Â∫üÊñôÁõ¥ÂçáÊú∫", camper: "ÊàøËΩ¶Ê®°Âùó" }
        }
    };

    // --- CRAFTING RECIPES ---
    // Added 'wb' (Workbench Level) and 'scrap' (Research Cost)
    const recipes = {
        rocket: { id: "rocket", wb: 3, scrap: 125, sulfurTotal: 1400, gpPerItem: 650, explosivesPerItem: 10, rawSulfurToKeep: 100, imgUrl: "https://rustlabs.com/img/items180/ammo.rocket.basic.png", other: [{id:"charcoal", amount:1950},{id:"frags", amount:100},{id:"fuel", amount:30},{id:"pipe", amount:2}] },
        c4: { id: "c4", wb: 3, scrap: 500, sulfurTotal: 2200, gpPerItem: 1000, explosivesPerItem: 20, rawSulfurToKeep: 200, imgUrl: "https://rustlabs.com/img/items180/explosive.timed.png", other: [{id:"charcoal", amount:3000},{id:"frags", amount:200},{id:"fuel", amount:60},{id:"tech", amount:2},{id:"cloth", amount:5}] },
        satchel: { id: "satchel", wb: 1, scrap: 125, sulfurTotal: 480, gpPerItem: 240, explosivesPerItem: 0, rawSulfurToKeep: 0, imgUrl: "https://rustlabs.com/img/items180/explosive.satchel.png", other: [{id:"charcoal", amount:720}, {id:"frags", amount:80}, {id:"cloth", amount:10}, {id:"rope", amount:1}] },
        exp556: { 
            id: "exp556", 
            wb: 3, 
            scrap: 125, 
            sulfurTotal: 25, 
            gpPerItem: 10, 
            explosivesPerItem: 0, 
            rawSulfurToKeep: 5, 
            imgUrl: "https://rustlabs.com/img/items180/ammo.rifle.explosive.png", 
            // 1 Craft = 2 bullets. Recipe: 10 Frags + 20 GP + 10 Sulfur. 
            // Per 1 bullet: 5 Frags + 10 GP (30 charcoal).
            other: [{id:"frags", amount:5}, {id:"charcoal", amount:30}] 
        }, 
        hv: { id: "hv", wb: 2, scrap: 125, sulfurTotal: 200, gpPerItem: 100, explosivesPerItem: 0, rawSulfurToKeep: 0, imgUrl: "https://rustlabs.com/img/items180/ammo.rocket.hv.png", other: [{id:"charcoal", amount:300},{id:"pipe", amount:1}] },
        incen: { 
            id: "incen", 
            wb: 2, 
            scrap: 125, 
            sulfurTotal: 610, 
            gpPerItem: 300, 
            explosivesPerItem: 1, 
            rawSulfurToKeep: 10, 
            imgUrl: "https://rustlabs.com/img/items180/ammo.rocket.fire.png", 
            // 1 Exp (50 GP + 10 Sulfur + 10 Frag + 3 LGF) + 250 GP + 250 LGF + 2 Pipes
            // Total LGF = 253. Total GP = 300 (900 Charcoal).
            other: [{id:"charcoal", amount:900}, {id:"fuel", amount:253}, {id:"frags", amount:10}, {id:"pipe", amount:2}]
        },
        beancan: { id: "beancan", wb: 1, scrap: 75, sulfurTotal: 120, gpPerItem: 60, explosivesPerItem: 0, rawSulfurToKeep: 0, imgUrl: "https://rustlabs.com/img/items180/grenade.beancan.png", other: [] },
        molotov: { id: "molotov", wb: 2, scrap: 75, sulfurTotal: 0, gpPerItem: 0, explosivesPerItem: 0, rawSulfurToKeep: 0, imgUrl: "https://rustlabs.com/img/items180/grenade.molotov.png", other: [{id:"cloth", amount:10},{id:"fuel", amount:50}] },
        
        // ECO TOOLS (Sulfur 0)
        hatchet: { id: "hatchet", sulfurTotal: 0, imgUrl: "https://rustlabs.com/img/items180/hatchet.png", other: [{id:"wood", amount:100}, {id:"frags", amount:75}] },
        pickaxe: { id: "pickaxe", sulfurTotal: 0, imgUrl: "https://rustlabs.com/img/items180/pickaxe.png", other: [{id:"wood", amount:100}, {id:"frags", amount:125}] },
        spear: { id: "spear", sulfurTotal: 0, imgUrl: "https://rustlabs.com/img/items180/spear.wooden.png", other: [{id:"wood", amount:300}] },
        sword: { id: "sword", sulfurTotal: 0, imgUrl: "https://rustlabs.com/img/items180/salvaged.sword.png", other: [{id:"frags", amount:15}, {id:"blade", amount:1}] },
        jackhammer: { id: "jackhammer", sulfurTotal: 0, imgUrl: "https://rustlabs.com/img/items180/jackhammer.png", other: [] }, // Cannot craft
        fireArrow: { id: "fireArrow", sulfurTotal: 0, imgUrl: "https://rustlabs.com/img/items180/arrow.fire.png", other: [{id:"cloth", amount:2}, {id:"fuel", amount:2}] } 
    };

    // --- RAID DATA ---
    const raidTargets = {
        woodDoor: { hp: 200, imgUrl: "https://rustlabs.com/img/items180/door.hinged.wood.png", methods: { satchel: 2, molotov: 2, exp556: 19, beancan: 6, c4: 1 } },
        woodDouble: { hp: 200, imgUrl: "https://rustlabs.com/img/items180/door.double.hinged.wood.png", methods: { satchel: 2, molotov: 2, exp556: 19, beancan: 6, c4: 1 } },
        woodWall: { hp: 250, imgUrl: "https://rustlabs.com/img/items180/wood.png", methods: { rocket: 2, molotov: 4, satchel: 3, exp556: 49, c4: 1 } },
        stoneWall: { hp: 500, imgUrl: "https://rustlabs.com/img/items180/stones.png", methods: { rocket: 4, satchel: 10, exp556: 185, c4: 2 } },
        metalWall: { hp: 1000, imgUrl: "https://rustlabs.com/img/items180/metal.fragments.png", methods: { rocket: 8, satchel: 23, exp556: 400, c4: 4 } },
        armoredWall: { hp: 2000, imgUrl: "https://rustlabs.com/img/items180/metal.refined.png", methods: { rocket: 15, satchel: 46, exp556: 799, c4: 8 } },
        sheetDoor: { hp: 250, imgUrl: "https://rustlabs.com/img/items180/door.hinged.metal.png", methods: { rocket: 1, satchel: 4, exp556: 63, c4: 1 } },
        sheetDouble: { hp: 250, imgUrl: "https://rustlabs.com/img/items180/door.double.hinged.metal.png", methods: { rocket: 1, satchel: 4, exp556: 63, c4: 1 } },
        garageDoor: { hp: 600, imgUrl: "https://rustlabs.com/img/items180/wall.frame.garagedoor.png", methods: { rocket: 3, satchel: 9, exp556: 150, c4: 2 } },
        armoredDoor: { hp: 1000, imgUrl: "https://rustlabs.com/img/items180/door.hinged.toptier.png", methods: { rocket: 5, satchel: 15, exp556: 250, c4: 3 } },
        armoredDouble: { hp: 1000, imgUrl: "https://rustlabs.com/img/items180/door.double.hinged.toptier.png", methods: { rocket: 5, satchel: 15, exp556: 250, c4: 3 } },
        highWood: { hp: 500, imgUrl: "https://rustlabs.com/img/items180/wall.external.high.png", methods: { rocket: 3, molotov: 4, satchel: 6, exp556: 98, c4: 2 } },
        highStone: { hp: 500, imgUrl: "https://rustlabs.com/img/items180/wall.external.high.stone.png", methods: { rocket: 4, satchel: 10, exp556: 185, c4: 2 } },
        turret: { hp: 1000, imgUrl: "https://rustlabs.com/img/items180/autoturret.png", methods: { hv: 3, satchel: 2, exp556: 102, rocket: 1 } },
        sam: { hp: 1000, imgUrl: "https://rustlabs.com/img/items180/samsite.png", methods: { hv: 3, satchel: 2, exp556: 102, rocket: 1 } }
    };

    // --- ECO / SPECIAL TARGETS ---
    const ecoTargets = {
        tc: { imgUrl: "https://rustlabs.com/img/items180/cupboard.tool.png", methods: { hatchet: 5, satchel: 2, exp556: 100, fireArrow: 40 } },
        softWood: { imgUrl: "https://rustlabs.com/img/items180/wood.png", methods: { spear: 24, sword: 6, hatchet: 4 } },
        softStone: { imgUrl: "https://rustlabs.com/img/items180/stones.png", methods: { pickaxe: 7, jackhammer: 2, spear: 236 } },
        mini: { imgUrl: "https://rustlabs.com/img/items180/minicopter.png", methods: { hv: 2, exp556: 121, fireArrow: 65, rocket: 1 } },
        scrappy: { imgUrl: "https://wiki.rustclash.com/img/screenshots/scrap-heli.png", methods: { hv: 3, rocket: 2, exp556: 200 } },
        camper: { imgUrl: "https://wiki.rustclash.com/img/items180/vehicle.2mod.camper.png", methods: { rocket: 2, satchel: 10, c4: 1 } }
    };

    let currentLang = "en";

    function switchTab(tab) {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('t_tab' + (tab.charAt(0).toUpperCase() + tab.slice(1))).classList.add('active');
        document.querySelectorAll('.view-section').forEach(v => v.classList.remove('active'));
        document.getElementById('view-' + tab).classList.add('active');
    }

    function setLang(lang) {
        currentLang = lang;
        localStorage.setItem('rust_lang', lang);
        document.querySelectorAll('.flag-btn').forEach(btn => btn.classList.remove('active'));
        document.getElementById('btn-' + lang).classList.add('active');
        updateUI();
        calculateCraft();
        calculateRaid();
        calculateEco();
    }

    function updateUI() {
        const t = translations[currentLang];
        document.getElementById('t_tabCraft').innerText = t.tabCraft;
        document.getElementById('t_tabRaid').innerText = t.tabRaid;
        document.getElementById('t_tabEco').innerText = t.tabEco;
        
        document.getElementById('t_selectItem').innerText = t.selectItem;
        document.getElementById('t_enterSulfur').innerText = t.enterSulfur;
        document.getElementById('t_calculateBtn').innerText = t.calculateBtn;
        document.getElementById('t_resetBtn').innerText = t.resetBtn;
        document.getElementById('t_youCanCraft').innerText = t.youCanCraft;
        document.getElementById('t_sulfurManagement').innerText = t.sulfurManagement;
        document.getElementById('t_otherMaterials').innerText = t.otherMaterials;
        document.getElementById('t_step1').innerText = t.step1;
        document.getElementById('t_step2').innerText = t.step2;
        document.getElementById('t_step3').innerText = t.step3;
        document.getElementById('t_sulfurRaw').innerText = t.sulfurRaw;
        document.getElementById('t_sulfurRaw2').innerText = t.sulfurRaw;
        document.getElementById('t_gp').innerText = t.gp;
        document.getElementById('t_inInventory').innerText = t.inInventory;
        
        document.getElementById('t_selectTarget').innerText = t.selectTarget;
        document.getElementById('t_targetCountLabel').innerText = t.targetCountLabel;
        document.getElementById('t_raidOptions').innerText = t.raidOptions;
        document.getElementById('t_method').innerText = t.method;
        document.getElementById('t_quantity').innerText = t.quantity;
        document.getElementById('t_cost').innerText = t.cost;
        
        document.getElementById('t_selectEcoTarget').innerText = t.selectEcoTarget;
        document.getElementById('t_ecoOptions').innerText = t.ecoOptions;
        document.getElementById('t_ecoMethod').innerText = t.ecoMethod;
        document.getElementById('t_ecoQuantity').innerText = t.ecoQuantity;
        document.getElementById('t_ecoCost').innerText = t.ecoCost;

        populateCraftSelect(t);
        populateRaidSelect(t);
        populateEcoSelect(t);
    }

    function populateCraftSelect(t) {
        const select = document.getElementById('itemType');
        const savedVal = select.value;
        select.innerHTML = "";
        for (const [key, value] of Object.entries(recipes)) {
            // Only show items with sulfur cost > 0 for crafting tab
            if(key === 'beancan' || value.sulfurTotal === 0) continue; 
            const opt = document.createElement('option');
            opt.value = key;
            opt.innerText = t.items[value.id] || value.id;
            select.appendChild(opt);
        }
        if (savedVal && recipes[savedVal] && recipes[savedVal].sulfurTotal > 0) select.value = savedVal;
        updateTechInfo();
    }

    function populateRaidSelect(t) {
        const select = document.getElementById('targetType');
        const savedVal = select.value;
        select.innerHTML = "";
        for (const [key, value] of Object.entries(raidTargets)) {
            const opt = document.createElement('option');
            opt.value = key;
            opt.innerText = t.targets[key] || key;
            select.appendChild(opt);
        }
        if (savedVal && raidTargets[savedVal]) select.value = savedVal;
    }

    function populateEcoSelect(t) {
        const select = document.getElementById('ecoTargetType');
        const savedVal = select.value;
        select.innerHTML = "";
        for (const [key, value] of Object.entries(ecoTargets)) {
            const opt = document.createElement('option');
            opt.value = key;
            opt.innerText = t.targets[key] || key;
            select.appendChild(opt);
        }
        if (savedVal && ecoTargets[savedVal]) select.value = savedVal;
    }

    function updateTechInfo() {
        const type = document.getElementById('itemType').value;
        const recipe = recipes[type];
        const container = document.getElementById('techInfoDisplay');
        if(!recipe || !recipe.wb) { container.innerHTML = ''; return; }

        let wbClass = `badge-wb${recipe.wb}`;
        let wbText = `Level ${recipe.wb} WB`;
        
        container.innerHTML = `
            <span class="badge ${wbClass}">${wbText}</span>
            <span class="badge badge-scrap">${recipe.scrap} Scrap</span>
        `;
    }

    function onCraftItemChange() {
        updateTechInfo();
        if(document.getElementById('craftResult').style.display === 'block') {
            calculateCraft();
        }
    }

    function resetCraft() {
        document.getElementById('sulfur').value = "";
        document.getElementById('craftResult').style.display = 'none';
    }

    function calculateCraft() {
        const sulfurInput = parseInt(document.getElementById('sulfur').value);
        const type = document.getElementById('itemType').value;
        const recipe = recipes[type];
        const t = translations[currentLang];
        
        if (isNaN(sulfurInput) || sulfurInput <= 0) return;
        if (recipe.sulfurTotal === 0) { alert("This item doesn't require sulfur."); return; }

        const maxItems = Math.floor(sulfurInput / recipe.sulfurTotal);
        if (maxItems === 0) { alert(`Not enough Sulfur!`); return; }
        const totalGP = maxItems * recipe.gpPerItem;
        const sulfurForGP = totalGP * 2;
        const totalExp = maxItems * recipe.explosivesPerItem;
        const sulfurReserved = maxItems * recipe.rawSulfurToKeep;
        
        document.getElementById('resultImage').src = recipe.imgUrl;
        let countText = maxItems + " x " + (t.items[recipe.id] || recipe.id);
        if(recipe.id === 'exp556') countText += ` (${maxItems} bullets)`;
        document.getElementById('finalCount').innerText = countText;
        const leftover = sulfurInput - (maxItems * recipe.sulfurTotal);
        document.getElementById('itemNameDisplay').innerText = `(${t.leftover}: ${leftover})`;
        document.getElementById('sulfurToGP').innerText = sulfurForGP.toLocaleString();
        document.getElementById('gpCount').innerText = totalGP.toLocaleString();
        const expBox = document.getElementById('expInstructionBox');
        if (recipe.rawSulfurToKeep > 0) {
            expBox.style.display = 'block';
            document.getElementById('sulfurToKeep').innerText = sulfurReserved.toLocaleString();
            document.getElementById('t_step4').innerText = recipe.explosivesPerItem > 0 ? t.step4 : t.useForAmmo;
            document.getElementById('expCount').innerText = recipe.explosivesPerItem > 0 ? totalExp.toLocaleString() : "";
            document.getElementById('expLabel').innerText = recipe.explosivesPerItem > 0 ? " " + t.explosives : "";
        } else {
            expBox.style.display = 'none';
        }
        const listEl = document.getElementById('materialsList');
        listEl.innerHTML = "";
        recipe.other.forEach(mat => {
            const totalNeeded = mat.amount * maxItems;
            const li = document.createElement('li');
            li.innerHTML = `<span>${t.items[mat.id] || mat.id}</span> <span class="val">${totalNeeded.toLocaleString()}</span>`;
            listEl.appendChild(li);
        });
        document.getElementById('craftResult').style.display = 'block';
        updateTechInfo();
    }

    function calculateRaid() {
        const targetKey = document.getElementById('targetType').value;
        const countInput = document.getElementById('targetCount').value;
        const count = Math.max(1, parseInt(countInput) || 1);

        const target = raidTargets[targetKey];
        const t = translations[currentLang];
        
        const imgEl = document.getElementById('raidTargetImage');
        if(target.imgUrl) { imgEl.src = target.imgUrl; imgEl.style.display = 'block'; } else { imgEl.style.display = 'none'; }

        const tbody = document.getElementById('raidTableBody');
        tbody.innerHTML = "";
        let methods = [];
        for (const [weaponKey, amountPerOne] of Object.entries(target.methods)) {
            const recipe = recipes[weaponKey];
            if (!recipe) continue;
            
            const totalAmount = amountPerOne * count;
            // Cost calculation: Sulfur total OR Material cost logic for non-sulfur items
            const totalSulfur = totalAmount * recipe.sulfurTotal;
            methods.push({ key: weaponKey, name: t.items[weaponKey] || weaponKey, amount: totalAmount, cost: totalSulfur, img: recipe.imgUrl });
        }
        methods.sort((a, b) => {
             // Put 0 sulfur items (molotovs) after sulfur items, or treat them as cheap? 
             // Usually Molotovs are "cheap" raid, so let's put 0 cost first.
             if (a.cost === 0 && b.cost > 0) return -1;
             if (a.cost > 0 && b.cost === 0) return 1;
             return a.cost - b.cost;
        });

        methods.forEach(m => {
            const tr = document.createElement('tr');
            let costDisplay;
            
            // Special display for Non-Sulfur Raid Items (Molotovs) in Raid View
            if (m.cost === 0 && recipes[m.key].other) {
                let mats = [];
                recipes[m.key].other.forEach(mat => {
                    mats.push(`${(mat.amount * m.amount).toLocaleString()} ${t.items[mat.id] || mat.id}`);
                });
                costDisplay = `<span class="resource-cost">${mats.join(', ')}</span>`;
            } else {
                costDisplay = `<span class="sulfur-cost">${m.cost.toLocaleString()} Sulfur</span>`;
            }

            tr.innerHTML = `<td><div class="raid-method-flex"><img src="${m.img}" class="raid-method-icon"><span>${m.name}</span></div></td><td class="item-count">${m.amount}</td><td>${costDisplay}</td>`;
            tbody.appendChild(tr);
        });
    }

    function calculateEco() {
        const targetKey = document.getElementById('ecoTargetType').value;
        const target = ecoTargets[targetKey];
        const t = translations[currentLang];
        
        const imgEl = document.getElementById('ecoTargetImage');
        if(target.imgUrl) { imgEl.src = target.imgUrl; imgEl.style.display = 'block'; } else { imgEl.style.display = 'none'; }

        const tbody = document.getElementById('ecoTableBody');
        tbody.innerHTML = "";
        let methods = [];
        for (const [weaponKey, amount] of Object.entries(target.methods)) {
            const recipe = recipes[weaponKey];
            if (!recipe) continue;
            
            // Check if it's a sulfur weapon or tool
            const isTool = recipe.sulfurTotal === 0;
            methods.push({ 
                key: weaponKey, 
                name: t.items[weaponKey] || weaponKey, 
                amount: amount, 
                sulfurCost: amount * recipe.sulfurTotal,
                isTool: isTool,
                img: recipe.imgUrl 
            });
        }
        
        // Sort: Tools (0 sulfur) first, then by sulfur cost
        methods.sort((a, b) => {
            if (a.sulfurCost === 0 && b.sulfurCost > 0) return -1;
            if (a.sulfurCost > 0 && b.sulfurCost === 0) return 1;
            return a.sulfurCost - b.sulfurCost;
        });

        methods.forEach(m => {
            const tr = document.createElement('tr');
            let costDisplay = "";

            if (m.isTool) {
                // Calculate resources for tools (e.g. 7 pickaxes = X Wood, Y Metal)
                let mats = [];
                recipes[m.key].other.forEach(mat => {
                    let totalMat = mat.amount * m.amount;
                    mats.push(`<span class="resource-highlight">${totalMat.toLocaleString()}</span> ${t.items[mat.id] || mat.id}`);
                });
                costDisplay = `<span class="resource-cost">${mats.join(', ')}</span>`;
            } else {
                costDisplay = `<span class="sulfur-cost">${m.sulfurCost.toLocaleString()} Sulfur</span>`;
            }
            
            tr.innerHTML = `<td><div class="raid-method-flex"><img src="${m.img}" class="raid-method-icon"><span>${m.name}</span></div></td><td class="item-count">${m.amount}</td><td>${costDisplay}</td>`;
            tbody.appendChild(tr);
        });
    }

    // PWA Logic
    let deferredPrompt;
    const installBtn = document.getElementById('installBtn');
    window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault(); deferredPrompt = e; installBtn.style.display = 'block';
    });
    installBtn.addEventListener('click', async () => {
        if (deferredPrompt) { deferredPrompt.prompt(); deferredPrompt = null; installBtn.style.display = 'none'; }
    });
    // --- SMART PWA UPDATE LOGIC ---
if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js').then(reg => {
            
            
            if (reg.waiting) {
                showUpdateNotification(reg.waiting);
                return;
            }

            
            reg.addEventListener('updatefound', () => {
                const newWorker = reg.installing;
                
                newWorker.addEventListener('statechange', () => {
                   
                    if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                        showUpdateNotification(newWorker);
                    }
                });
            });
        });

        
        let refreshing;
        navigator.serviceWorker.addEventListener('controllerchange', () => {
            if (refreshing) return;
            window.location.reload();
            refreshing = true;
        });
    });
}

function showUpdateNotification(worker) {
    const notification = document.getElementById('updateNotification');
    const btn = document.getElementById('updateBtn');
    
    notification.style.display = 'block';
    
    btn.addEventListener('click', () => {
        // Po≈°li zpr√°vu do SW: "P≈ôeskoƒç frontu a aktivuj se!"
        worker.postMessage({ type: 'SKIP_WAITING' });
        // Tlaƒç√≠tko ze≈°edne, aby u≈æivatel neklikal znovu
        btn.disabled = true;
        btn.innerText = "Updating...";
    });
}

    // --- INITIALIZATION ---
    const savedLang = localStorage.getItem('rust_lang');
    setLang(savedLang || 'en');

</script>
</body>
</html>
